"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[2945],{18486:function(t,e,n){n.d(e,{Hq:function(){return q},Mk:function(){return p},P_:function(){return B},Qp:function(){return K},VO:function(){return k},_D:function(){return S},kZ:function(){return J},kr:function(){return X},nF:function(){return P},tB:function(){return N},ut:function(){return L},vF:function(){return Q},zD:function(){return b}});n(91957);var i,a=n(70375),s=n(61681),r=n(17321),o=n(96926),l=n(4757),c=n(91772),h=n(70909),u=n(89542),f=n(14685);function p(t,e,n){return!(0,l.Up)(t,e,n)}function d(t,e,n){const i=p(t,e,n);if(i&&!(0,l.kR)())throw new a.Z("rasterprojectionhelper-project","projection engine is not loaded");return i}!function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"}(i||(i={}));const m=(t,e,n,i=0)=>{if(1===n[0])return[0,0];let a=1,s=-1,r=1,o=-1;for(let x=0;x<t.length;x+=2)isNaN(t[x])||(a=a>t[x]?t[x]:a,s=s>t[x]?s:t[x],r=r>t[x+1]?t[x+1]:r,o=o>t[x+1]?o:t[x+1]);const{cols:l,rows:c}=e,h=(s-a)/l/n[0],u=(o-r)/c/n[1],f=2*i;let p=0,d=!1,m=[0,0];for(let x=0;x<l-3;x++){for(let e=0;e<c-3;e++){const n=x*c*2+2*e,i=(t[n]+t[n+4]+t[n+4*c]+t[n+4*c+4])/4,a=(t[n+1]+t[n+5]+t[n+4*c+1]+t[n+4*c+5])/4,s=Math.abs((i-t[n+2*c+2])/h),r=Math.abs((a-t[n+2*c+3])/u);if(s+r>p&&(p=s+r,m=[s,r]),f&&p>f){d=!0;break}}if(d)break}return m},x={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},g=32,y=4,_=y,w=new Map,v=new Map,M=500;async function b(){(0,l.kR)()||await(0,l.zD)()}function S(t,e,n){return d(t.spatialReference,e)?n?(0,l.rS)(e,t.spatialReference,t):(0,l.rS)(t.spatialReference,e,t):null}function k(t,e,n,i=null){const a=t.spatialReference;if(a.equals(e))return t;d(a,e,i);const o=n.center,h=new c.Z({xmin:o.x-t.x/2,xmax:o.x+t.x/2,ymin:o.y-t.y/2,ymax:o.y+t.y/2,spatialReference:a}),u=(0,l.iV)(h,e,i),f=L(e);let p;if((0,s.Wi)(u)||(0,s.pC)(f)&&u.width>=f){const n=(0,r.c9)(a)/(0,r.c9)(e);p={x:t.x*n,y:t.y*n}}else p={x:u.width,y:u.height};return p}function R(t,e=.01){return(0,r.c9)(t)?e/(0,r.c9)(t):0}function P(t,e,n=null,i=!0){const a=t.spatialReference;if(a.equals(e))return t;d(a,e,n);const s=(0,l.iV)(t,e,n);return i&&s?(A([t],[s],a,e),s):s}function A(t,e,n,i){const a=W(n,!0),r=W(i,!0),o=R(n,M),l=R(i,M);if(o&&(0,s.pC)(a)&&(0,s.pC)(r))for(let s=0;s<t.length;s++){const n=e[s];if(!n)continue;const{x:i}=t[s],{x:c}=n;c>=r[1]-l&&Math.abs(i-a[0])<o?n.x-=r[1]-r[0]:c<=r[0]+l&&Math.abs(i-a[1])<o&&(n.x+=r[1]-r[0])}}function C(t){const{inSR:e,outSR:n,datumTransformation:i,preferPE:a}=t;if(e.equals(n)){const{points:e}=z(t,null);return e}if(e.isWebMercator&&n.isWGS84||e.isWGS84&&n.isWebMercator)return T(t);if(d(e,n,i)&&a){if(e.isGeographic)return I(t);const n=F(e);if((0,s.pC)(n))return I(t)}return D(t)}function D(t){const{points:e}=z(t,null),{inSR:n,outSR:i,datumTransformation:a}=t,s=e.map((t=>new h.Z(t[0],t[1],n))),r=(0,l.iV)(s,i,a);return a&&A(s,r,n,i),r.map((t=>t?[t.x,t.y]:[NaN,NaN]))}function I(t){const{inSR:e,outSR:n,datumTransformation:i}=t,a=F(e),{points:r,mask:l}=z(t,a);if(!e.isGeographic){const t=e.wkid?o.e.coordsys(e.wkid):o.e.fromString(e.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,e.wkt);o.g.projToGeog(t,r.length,r)}if((0,s.pC)(i)&&i.steps.length){let t;const e=179.9955;if(n.isGeographic&&(t=r.map((([t])=>t>e?1:t<-e?-1:0))),i.steps.forEach((t=>{const e=t.wkid?o.e.geogtran(t.wkid):o.e.fromString(o.f.PE_TYPE_GEOGTRAN,t.wkt);o.h.geogToGeog(e,r.length,r,null,t.isInverse?o.f.PE_TRANSFORM_2_TO_1:o.f.PE_TRANSFORM_1_TO_2)})),t)for(let n=0;n<r.length;n++){const i=t[n],a=r[n][0],s=a>e?1:a<-e?-1:0;i&&s&&i!==s&&(r[n][0]=i>0?a+360:a-360)}}if(!n.isGeographic){const t=F(n,!0),e=(0,s.pC)(t)&&t.isEnvelope?[t.bbox[1],t.bbox[3]]:[-90,90];V(r,e);const i=n.wkid?o.e.coordsys(n.wkid):o.e.fromString(n.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,n.wkt);o.g.geogToProj(i,r.length,r)}let c=r;if(l&&r.length!==l.length){c=[];for(let t=0,e=0;t<l.length;t++)l[t]?c.push(r[e++]):c.push([NaN,NaN])}return c}function T(t){const{cols:e,rows:n,xres:i,yres:a,usePixelCenter:s,inSR:r,outSR:o}=t;let{xmin:c,ymax:u}=t;s&&(c+=i/2,u-=a/2);const f=[],p=[],d=Math.max(e,n);for(let x=0;x<d;x++){const t=c+i*Math.min(e,x),s=u-a*Math.min(n,x),d=(0,l.iV)(new h.Z({x:t,y:s,spatialReference:r}),o);x<=e&&f.push(d.x),x<=n&&p.push(d.y)}const m=[];for(let l=0;l<e;l++)for(let t=0;t<n;t++)m.push([f[l],p[t]]);return m}function F(t,e=!1){let n=t.wkid||t.wkt;if(!n||t.isGeographic)return null;if(n=String(n),w.has(n)){const t=w.get(n);return e?t?.gcs:t?.pcs}const i=t.wkid?o.e.coordsys(t.wkid):o.e.fromString(t.isGeographic?o.f.PE_TYPE_GEOGCS:o.f.PE_TYPE_PROJCS,t.wkt),a=E(i,R(t,1e-4)),s=E(i,0,!0);return w.set(n,{pcs:a,gcs:s}),e?s:a}function E(t,e=0,n=!1){const i=o.j.generate(t),a=n?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!i||!a?.length)return null;let s=!1,r=a.find((t=>1===t.getInclusive()&&1===t.getKind()));if(!r){if(r=a.find((t=>1===t.getInclusive()&&0===t.getKind())),!r)return null;s=!0}const l=n?0:(2===i.getNorthPoleLocation()?1:0)|(2===i.getSouthPoleLocation()?2:0),c=i.isPannableRectangle(),h=r.getCoord();if(s)return{isEnvelope:s,isPannable:c,vertices:h,coef:null,bbox:[h[0][0]-e,h[0][1]-e,h[1][0]+e,h[1][1]+e],poleLocation:l};let u=0;const f=[];let[p,d]=h[0],[m,x]=h[0];for(let o=0,g=h.length;o<g;o++){u++,u===g&&(u=0);const[t,e]=h[o],[n,i]=h[u];if(i===e)f.push([t,n,e,i,2]);else{const a=(n-t)/(i-e||1e-4),s=t-a*e;e<i?f.push([a,s,e,i,0]):f.push([a,s,i,e,1])}p=p<t?p:t,d=d<e?d:e,m=m>t?m:t,x=x>e?x:e}return{isEnvelope:!1,isPannable:c,vertices:h,coef:f,bbox:[p,d,m,x],poleLocation:l}}function z(t,e){const n=[],{cols:i,rows:a,xres:r,yres:o,usePixelCenter:l}=t;let{xmin:c,ymax:h}=t;if(l&&(c+=r/2,h-=o/2),(0,s.Wi)(e)){for(let t=0;t<i;t++)for(let e=0;e<a;e++)n.push([c+r*t,h-o*e]);return{points:n}}const u=new Uint8Array(i*a);if(e.isEnvelope){const{bbox:[t,s,l,f]}=e;for(let p=0,d=0;p<i;p++){const i=c+r*p,m=e.isPannable||i>=t&&i<=l;for(let t=0;t<a;t++,d++){const e=h-o*t;m&&e>=s&&e<=f&&(n.push([i,e]),u[d]=1)}}return{points:n,mask:u}}const f=e.coef,p=[];for(let s=0;s<a;s++){const t=h-o*s,e=[],n=[];for(let a=0;a<f.length;a++){const[i,s,r,o,l]=f[a];if(t===r&&r===o)e.push(i),e.push(s),n.push(2),n.push(2);else if(t>=r&&t<=o){const a=i*t+s;e.push(a),n.push(l)}}let i=e;if(e.length>2){let t=2===n[0]?0:n[0],a=e[0];i=[];for(let s=1;s<n.length;s++)2===n[s]&&s!==n.length-1||(n[s]!==t&&(i.push(0===t?Math.min(a,e[s-1]):Math.max(a,e[s-1])),t=n[s],a=e[s]),s===n.length-1&&i.push(0===n[s]?Math.min(a,e[s]):Math.max(a,e[s])));i.sort(((t,e)=>t-e))}else e[0]>e[1]&&(i=[e[1],e[0]]);p.push(i)}for(let s=0,d=0;s<i;s++){const t=c+r*s;for(let e=0;e<a;e++,d++){const i=h-o*e,a=p[e];if(2===a.length)t>=a[0]&&t<=a[1]&&(n.push([t,i]),u[d]=1);else if(a.length>2){let e=!1;for(let n=0;n<a.length;n+=2)if(t>=a[n]&&t<=a[n+1]){e=!0;break}e&&(n.push([t,i]),u[d]=1)}}}return{points:n,mask:u}}function V(t,e){const[n,i]=e;for(let a=0;a<t.length;a++){const e=t[a][1];(e<n||e>i)&&(t[a]=[NaN,NaN])}}function O(t){const e=L(t[0].spatialReference);if(t.length<2||(0,s.Wi)(e))return t[0];let{xmin:n,xmax:i,ymin:a,ymax:r}=t[0];for(let s=1;s<t.length;s++){const n=t[s];i=n.xmax+e*s,a=Math.min(a,n.ymin),r=Math.max(r,n.ymax)}return new c.Z({xmin:n,xmax:i,ymin:a,ymax:r,spatialReference:t[0].spatialReference})}function N(t,e,n=null,a=!0){const r=t.spatialReference;if(r.equals(e))return t;const o=q(t),h=L(r,!0),u=L(e);if(0===o||(0,s.Wi)(h)||(0,s.Wi)(u)){const o=G(t,e,n,a);if((0,s.Wi)(h)&&(0,s.pC)(u)&&Math.abs(o.width-u)<R(e)&&(0,l.kR)()){const n=F(r);if((0,s.pC)(n)&&n.poleLocation===i.None&&t.width<(n.bbox[2]-n.bbox[0])/2)return U(t,e)||o}return o}const f=t.clone().normalize();if(1===f.length&&t.xmax<h&&t.xmax-h/2>R(r)){const{xmin:e,xmax:n}=t;for(let i=0;i<=o;i++){const a=0===i?e:-h/2,s=i===o?n-h*i:h/2;f[i]=new c.Z({xmin:a,xmax:s,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}return O(f.map((t=>G(t,e,n,a))).filter(s.pC))}function U(t,e){const n=L(e);if((0,s.Wi)(n))return null;let{xmin:i,ymin:a,xmax:r,ymax:o}=t;const h=t.spatialReference,f=new u.Z({spatialReference:h,rings:[[[i,a],[r,a],[r,o],[i,o],[i,a]]]}),p=(0,l.iV)(f,e);if(2!==p.rings.length||!p.rings[0].length||!p.rings[1].length)return null;const{rings:d}=p,m=R(h),x=new c.Z({spatialReference:e});for(let s=0;s<2;s++){i=r=d[s][0][0],a=o=d[s][0][1];for(let t=0;t<d[s].length;t++)i=i>d[s][t][0]?d[s][t][0]:i,r=r<d[s][t][0]?d[s][t][0]:r,a=a>d[s][t][1]?d[s][t][1]:a,o=o<d[s][t][1]?d[s][t][1]:o;if(0===s)x.ymin=a,x.ymax=o,x.xmin=i,x.xmax=r;else if(x.ymin=Math.min(x.ymin,a),x.ymax=Math.max(x.ymax,o),Math.abs(r-n/2)<m)x.xmin=i,x.xmax=x.xmax+n;else{if(!(Math.abs(i+n/2)<m))return null;x.xmax=r+n}}return x}function G(t,e,n=null,i=!0,a=!0){const r=t.spatialReference;if(r.equals(e)||!e)return t;d(r,e,n);const o=(0,l.iV)(t,e,n);if(a&&e.isWebMercator&&o&&(o.ymax=Math.min(20037508.342787,o.ymax),o.ymin=Math.max(-20037508.342787,o.ymin),o.ymin>=o.ymax))return null;if(!i||!o)return o;const c=W(r,!0),u=W(e,!0);if((0,s.Wi)(c)||(0,s.Wi)(u))return o;const f=R(r,.001),p=R(r,M),m=R(e,.001);if(Math.abs(o.xmin-u[0])<m&&Math.abs(o.xmax-u[1])<m){const i=Math.abs(t.xmin-c[0]),a=Math.abs(c[1]-t.xmax);if(i<f&&a>p){o.xmin=u[0];const i=[];i.push(new h.Z(t.xmax,t.ymin,r)),i.push(new h.Z(t.xmax,(t.ymin+t.ymax)/2,r)),i.push(new h.Z(t.xmax,t.ymax,r));const a=i.map((t=>P(t,e,n))).filter((t=>!isNaN(t?.x))).map((t=>t.x));o.xmax=Math.max.apply(null,a)}if(a<f&&i>p){o.xmax=u[1];const i=[];i.push(new h.Z(t.xmin,t.ymin,r)),i.push(new h.Z(t.xmin,(t.ymin+t.ymax)/2,r)),i.push(new h.Z(t.xmin,t.ymax,r));const a=i.map((t=>P(t,e,n))).filter((t=>!isNaN(t?.x))).map((t=>t.x));o.xmin=Math.min.apply(null,a)}}else{const t=R(e,.001);Math.abs(o.xmin-u[0])<t&&(o.xmin=u[0]),Math.abs(o.xmax-u[1])<t&&(o.xmax=u[1])}return o}function L(t,e=!1){if(!t)return null;const n=e?20037508.342787:20037508.342788905;return t.isWebMercator?2*n:t.wkid&&t.isGeographic?360:2*x[t.wkid]||null}function W(t,e=!1){if(t.isGeographic)return[-180,180];const n=L(t,e);return(0,s.pC)(n)?[-n/2,n/2]:null}function Z(t,e,n,i){let a=(t-e)/n;return a-Math.floor(a)!=0?a=Math.floor(a):i&&(a-=1),a}function q(t,e=!1){const n=L(t.spatialReference);if((0,s.Wi)(n))return 0;const i=e?0:-n/2,a=R(t.spatialReference),r=!e&&Math.abs(t.xmax-n/2)<a?n/2:t.xmax,o=!e&&Math.abs(t.xmin+n/2)<a?-n/2:t.xmin;return Z(r,i,n,!0)-Z(o,i,n,!1)}function B(t){const e=t.storageInfo.origin.x,n=L(t.spatialReference,!0);if((0,s.Wi)(n))return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const i=n/2,{nativePixelSize:a,storageInfo:r,extent:o}=t,{maximumPyramidLevel:l,blockWidth:c,pyramidScalingFactor:h}=r;let u=a.x;const f=[],p=(0,s.pC)(t.transform)&&"gcs-shift"===t.transform.type,d=e+(p?0:i),m=p?n-e:i-e;for(let s=0;s<=l;s++){const t=(o.xmax-e)/u/c,n=t-Math.floor(t)==0?t:Math.ceil(t),i=m/u/c,a=i-Math.floor(i)==0?i:Math.ceil(i),s=Math.floor(d/u/c),r=Math.round(d/u)%c,l=(c-Math.round(m/u)%c)%c;f.push({resolutionX:u,blockWidth:c,datsetColumnCount:n,worldColumnCountFromOrigin:a,leftMargin:r,rightPadding:l,originColumnOffset:s}),u*=h}return{originX:e,halfWorldWidth:i,pyramidsInfo:f,hasGCSSShiftTransform:p}}function j(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt);let n;return v.has(e)?n=v.get(e):(n=(t.wkid?o.e.coordsys(t.wkid):o.e.fromString(o.f.PE_TYPE_PROJCS,t.wkt)).getGeogcs().getCode(),v.set(e,n)),new f.Z({wkid:n})}function K(t){const e=t.isAdaptive&&null==t.spacing;let n=t.spacing||[g,g],i=Y(t),a={cols:i.size[0]+1,rows:i.size[1]+1};const r=i.outofBoundPointCount>0&&i.outofBoundPointCount<i.offsets.length/2;let o=i.outofBoundPointCount===i.offsets.length/2||e&&r?[0,0]:m(i.offsets,a,n,_);const l=(o[0]+o[1])/2,c=t.projectedExtent.spatialReference,h=t.srcBufferExtent.spatialReference;if(e&&(r||l>_)&&(p(c,h,t.datumTransformation)&&(c.isGeographic||(0,s.pC)(F(c))),n=[y,y],i=Y({...t,spacing:n}),a={cols:i.size[0]+1,rows:i.size[1]+1},o=m(i.offsets,a,n,_)),i.error=o,n[0]>1&&(i.coefficients=H(i.offsets,a,r)),t.includeGCSGrid&&!c.isGeographic&&!c.isWebMercator)if(h.isGeographic)i.gcsGrid={offsets:i.offsets,coefficients:i.coefficients,spacing:n};else{const e=F(c);if((0,s.pC)(e)&&!e.isEnvelope){const e=j(c),s=N(t.projectedExtent,e),{offsets:o}=Y({...t,srcBufferExtent:s,spacing:n}),l=H(o,a,r);i.gcsGrid={offsets:o,coefficients:l,spacing:n}}}return i}function Y(t){const{projectedExtent:e,srcBufferExtent:n,pixelSize:i,datumTransformation:a,rasterTransform:r}=t,o=e.spatialReference,l=n.spatialReference,c=d(o,l),{xmin:u,ymin:f,xmax:p,ymax:m}=e,x=L(l),_=(0,s.pC)(x)&&(t.hasWrapAround||"gcs-shift"===r?.type),w=t.spacing||[g,g],v=w[0]*i.x,b=w[1]*i.y,S=1===w[0],k=Math.ceil((p-u)/v-.1/w[0])+(S?0:1),P=Math.ceil((m-f)/b-.1/w[1])+(S?0:1),A=C({cols:k,rows:P,xmin:u,ymax:m,xres:v,yres:b,inSR:o,outSR:l,datumTransformation:a,preferPE:w[0]<=y,usePixelCenter:S}),D=[];let I,T=0;const E=S?-1:NaN,{xmin:z,xmax:V,ymax:O,width:N,height:U}=n,G=R(l,M),W=(0,s.pC)(x)&&z>0&&V>x/2;let Z=!1;if(c){const t=F(o);Z=(0,s.pC)(t)&&t.poleLocation>0}for(let s=0;s<k;s++){const t=[];for(let e=0;e<P;e++){let n=A[s*P+e];if(_&&n[0]>V&&n[0]>x/2-G?n[0]-=x:_&&0===s&&n[0]<0&&W&&!r&&(n[0]+=x),!n||isNaN(n[0])||isNaN(n[1]))D.push(E),D.push(E),t.push(null),T++;else{if(r){const t=r.inverseTransform(new h.Z({x:n[0],y:n[1],spatialReference:l}));n=[t.x,t.y]}t.push(n),s>0&&_&&I[e]&&n[0]<I[e][0]&&(n[0]+=x,Z&&n[0]>V&&n[0]>x&&(n[0]-=x)),D.push((n[0]-z)/N),D.push((O-n[1])/U)}}I=t}return{offsets:D,error:null,coefficients:null,outofBoundPointCount:T,spacing:w,size:S?[k,P]:[k-1,P-1]}}function H(t,e,n){const{cols:i,rows:a}=e,s=new Float32Array((i-1)*(a-1)*2*6),r=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),o=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<i-1;l++){for(let e=0;e<a-1;e++){let n=l*a*2+2*e;const c=t[n],h=t[n+1],u=t[n+2],f=t[n+3];n+=2*a;const p=t[n],d=t[n+1],m=t[n+2],x=t[n+3];let g=0,y=12*(e*(i-1)+l);for(let t=0;t<3;t++)s[y++]=r[g++]*c+r[g++]*u+r[g++]*m;g=0;for(let t=0;t<3;t++)s[y++]=r[g++]*h+r[g++]*f+r[g++]*x;g=0;for(let t=0;t<3;t++)s[y++]=o[g++]*c+o[g++]*p+o[g++]*m;g=0;for(let t=0;t<3;t++)s[y++]=o[g++]*h+o[g++]*d+o[g++]*x}if(n)for(let t=0;t<s.length;t++)isNaN(s[t])&&(s[t]=-1)}return s}function J(t){const e=t.clone().normalize();return 1===e.length?e[0]:O(e)}function X(t,e,n){const{storageInfo:i,pixelSize:a}=e;let o=0,l=!1;const{pyramidResolutions:c}=i;if((0,s.pC)(c)&&c.length){const i=(t.x+t.y)/2,s=c[c.length-1],u=(s.x+s.y)/2,f=(a.x+a.y)/2;if(i<=f)o=0;else if(i>=u)o=c.length,l=i/u>8;else{let t,e=f;for(let a=1;a<=c.length;a++){if(t=(c[a-1].x+c[a-1].y)/2,i<=t){i===t?o=a:"down"===n?(o=a-1,l=i/e>8):o="up"===n||i-e>t-i||i/e>2?a:a-1;break}e=t}}const p=0===o?a:c[o-1];return l&&Math.min(p.x,p.y)*(0,r.c9)(e.spatialReference)>19567&&(l=!1),{pyramidLevel:o,pyramidResolution:new h.Z({x:p.x,y:p.y,spatialReference:e.spatialReference}),excessiveReading:l}}const u=Math.log(t.x/a.x)/Math.LN2,f=Math.log(t.y/a.y)/Math.LN2,p=e.storageInfo.maximumPyramidLevel||0;o="down"===n?Math.floor(Math.min(u,f)):"up"===n?Math.ceil(Math.max(u,f)):Math.round((u+f)/2),o<0?o=0:o>p&&(l=o>p+3,o=p);const d=2**o;return{pyramidLevel:o,pyramidResolution:new h.Z({x:d*e.nativePixelSize.x,y:d*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:l}}function Q(t,e,n=512,i=!0){const{extent:a,spatialReference:o,pixelSize:l}=t,c=k(new h.Z({x:l.x,y:l.y,spatialReference:o}),e,a);if(null==c)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(c.x+c.y)/2,f=(0,r.c9)(e),p=u*f*96*39.37,d=e.isGeographic?256/n*295828763.7958547:256/n*591657527.591555;let m="vector-magdir"===t.dataType||"vector-uv"===t.dataType;const x=N(a,e),g=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/p)/Math.LN2));if(!m&&i&&(e.isGeographic||e.isWebMercator)&&(m=x.xmin*x.xmax<0,!m&&g<3)){const t=L(e);if((0,s.pC)(t)){const e=2**g*u*n,i=Math.ceil(t/e);m=1===i||2===i&&t/2-x.xmax<e}}let y,_=p;const w=1.001;if(m){_=d;const t=e.isGeographic?1341104507446289e-21:.29858214164761665,n=t*(96*f*39.37),i=e.isGeographic?4326:3857;y=k(new h.Z({x:t,y:t,spatialReference:{wkid:i}}),o,x),y.x*=_/n,y.y*=_/n}else{y={x:l.x,y:l.y};let t=0;for(;_<d*(w/2)&&t<g;)t++,_*=2,y.x*=2,y.y*=2;Math.max(_,d)/Math.min(_,d)<=w&&(_=d)}const v=[_],M=[{x:y.x,y:y.y}],b=70.5310735,S=Math.min(b,p)/w;for(;_>=S;)_/=2,y.x/=2,y.y/=2,v.push(_),M.push({x:y.x,y:y.y});return{projectedPixelSize:c,scales:v,srcResolutions:M,isCustomTilingScheme:!m}}},7928:function(t,e,n){n.d(e,{BH:function(){return y},K:function(){return I},KC:function(){return x},NL:function(){return h},QI:function(){return g},Tg:function(){return p},Yx:function(){return u},nb:function(){return F},wF:function(){return T},xQ:function(){return m}});var i=n(25709),a=n(61681),s=n(5856),r=n(31329);const o=new Map;o.set("meter-per-second",1),o.set("kilometer-per-hour",.277778),o.set("knots",.514444),o.set("feet-per-second",.3048),o.set("mile-per-hour",.44704);const l=180/Math.PI,c=5,h=new i.X({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"});function u(t,e){return o.get(t)/o.get(e)||1}function f(t){return(450-t)%360}function p(t,e="geographic"){const[n,i]=t,a=Math.sqrt(n*n+i*i);let s=Math.atan2(i,n)*l;return s=(360+s)%360,"geographic"===e&&(s=f(s)),[a,s]}function d(t,e="geographic"){let n=t[1];"geographic"===e&&(n=f(n)),n%=360;const i=t[0];return[i*Math.cos(n/l),i*Math.sin(n/l)]}function m(t,e,n,i="geographic"){if(!(0,r.nk)(t)||(0,a.Wi)(n))return t;const s="vector-magdir"===e?t.clone():(0,a.Wg)(x(t,e)),o=s.pixels[1];for(let a=0;a<o.length;a++)o[a]="geographic"===i?(o[a]+n[a]+270)%360:(o[a]+360-n[a])%360;return"vector-magdir"===e?s:x(s,"vector-magdir")}function x(t,e,n="geographic",i=1){if(!(0,r.nk)(t))return t;const{pixels:a,width:o,height:l}=t,c=o*l,h=a[0],u=a[1],f=t.pixelType.startsWith("f")?t.pixelType:"f32",m=s.Z.createEmptyBand(f,c),x=s.Z.createEmptyBand(f,c);let g=0;for(let s=0;s<l;s++)for(let t=0;t<o;t++)"vector-uv"===e?([m[g],x[g]]=p([h[g],u[g]],n),m[g]*=i):([m[g],x[g]]=d([h[g],u[g]],n),m[g]*=i,x[g]*=i),g++;const y=new s.Z({pixelType:f,width:t.width,height:t.height,mask:t.mask,validPixelCount:t.validPixelCount,maskIsAlpha:t.maskIsAlpha,pixels:[m,x]});return y.updateStatistics(),y}function g(t,e,n=1){if(1===n||!(0,r.nk)(t))return t;const i=t.clone(),{pixels:a,width:s,height:o}=i,l=a[0],c=a[1];let h=0;for(let r=0;r<o;r++)for(let t=0;t<s;t++)"vector-uv"===e?(l[h]*=n,c[h]*=n):l[h]*=n,h++;return i.updateStatistics(),i}function y(t,e,n,i,s){if((0,a.Wi)(s)||!s.spatialReference.equals(t.spatialReference))return{extent:t,width:Math.round(e/i),height:Math.round(n/i),resolution:t.width/e};const r=s.xmin,o=s.ymax,l=(t.xmax-t.xmin)/e*i,c=(t.ymax-t.ymin)/n*i,h=(l+c)/2;return t.xmin=r+Math.floor((t.xmin-r)/l)*l,t.xmax=r+Math.ceil((t.xmax-r)/l)*l,t.ymin=o+Math.floor((t.ymin-o)/c)*c,t.ymax=o+Math.ceil((t.ymax-o)/c)*c,{extent:t,width:Math.round(t.width/l),height:Math.round(t.height/c),resolution:h}}const _=w(0,0,0);function w(t=0,e=0,n=Math.PI,i=!0){i&&(n=(2*Math.PI-n)%(2*Math.PI));const a=i?-1:1,s=13*a,r=-7*a,o=-2*a,l=-16*a,c=21.75,[h,u]=M(0,e+s,n,c),[f,p]=M(t-5.5,e+r,n,c),[d,m]=M(t+5.5,e+r,n,c),[x,g]=M(t-1.5,e+o,n,c),[y,_]=M(t+1.5,e+o,n,c),[w,v]=M(t-1.5,e+l,n,c),[b,S]=M(t+1.5,e+l,n,c);return[h,u,f,p,x,g,y,_,d,m,w,v,b,S]}function v(t=0,e=Math.PI,n=!0){n&&(e=(2*Math.PI-e)%(2*Math.PI));const i=10,a=n?-1:1,s=5*a,r=20*a,o=25*a,l=45,h=0,u=0,f=2,p=0,d=f*a,m=n?1:-1,x=i/2*m;let[g,y]=[h+x,u-r],[_,w]=[g+f*m,y],[v,b]=[_-p*m,w+d],[S,k]=[h-x,u-o],[R,P]=[S+p*m,k-d],A=Math.ceil(t/c),C=Math.floor(A/10);A-=8*C;const D=[],I=[];for(let c=0;c<A/2;c++,C--){C<=0&&A%2==1&&c===(A-1)/2&&(S=h,R=S+p*m,k=(k+y)/2,P=k-d);const[t,n]=M(S,k,e,l);if(C>0){const[i,a]=M(_,k,e,l),[s,r]=M(g,y,e,l);D.push(i),D.push(a),D.push(t),D.push(n),D.push(s),D.push(r)}else{const[i,a]=M(_,w,e,l),[s,r]=M(v,b,e,l),[o,c]=M(R,P,e,l);I.push(t),I.push(n),I.push(o),I.push(c),I.push(s),I.push(r),I.push(i),I.push(a)}k+=s,y+=s,w+=s,b+=s,P+=s}const[T,F]=M(h+x,u+r,e,l),E=(i/2+f)*m,[z,V]=M(h+E,u+r,e,l),[O,N]=M(h+x,u-o,e,l),[U,G]=M(h+E,u-o,e,l);return{pennants:D,barbs:I,shaft:[T,F,z,V,O,N,U,G]}}function M(t,e,n,i=1){const a=Math.sqrt(t*t+e*e)/i,s=(2*Math.PI+Math.atan2(e,t))%(2*Math.PI);return[a,(2*Math.PI+s-n)%(2*Math.PI)]}const b=[0,1,3,6,10,16,21,27,33,40,47,55,63],S=[0,.5,1,1.5,2],k=[0,.25,.5,1,1.5,2,2.5,3,3.5,4];function R(t,e,n,i){const a=u(i||"knots",n);let s;for(s=1;s<e.length;s++)if(s===e.length-1){if(t<e[s]*a)break}else if(t<=e[s]*a)break;return Math.min(s-1,e.length-2)}function P(t,e,n,i,a){let s=0;switch(e){case"beaufort_kn":s=R(t,b,"knots",n);break;case"beaufort_km":s=R(t,b,"kilometer-per-hour",n);break;case"beaufort_ft":s=R(t,b,"feet-per-second",n);break;case"beaufort_m":s=R(t,b,"meter-per-second",n);break;case"classified_arrow":s=R(t,a??[],i,n);break;case"ocean_current_m":s=R(t,S,"meter-per-second",n);break;case"ocean_current_kn":s=R(t,k,"knots",n)}return s}function A(t,e){const{style:n,inputUnit:i,outputUnit:s,breakValues:r}=e,o=h.fromJSON(i),l=h.fromJSON(s),c=42,u=15;let f=0,p=0;const{width:d,height:m,mask:x}=t,g=t.pixels[0],y=t.pixels[1],v=(0,a.pC)(x)?x.filter((t=>t>0)).length:d*m,M=new Float32Array(v*c),b=new Uint32Array(u*v),S=e.invertDirection?w(0,0,0,!1):_;for(let a=0;a<m;a++)for(let t=0;t<d;t++){const e=a*d+t;if(!x||x[a*d+t]){const i=(y[e]+360)%360/180*Math.PI,s=P(g[e],n,o,l,r);for(let n=0;n<S.length;n+=2)M[f++]=(t+.5)/d,M[f++]=(a+.5)/m,M[f++]=S[n],M[f++]=S[n+1]+i,M[f++]=s,M[f++]=g[e];const h=7*(f/c-1);b[p++]=h,b[p++]=h+1,b[p++]=h+2,b[p++]=h+0,b[p++]=h+4,b[p++]=h+3,b[p++]=h+0,b[p++]=h+2,b[p++]=h+3,b[p++]=h+2,b[p++]=h+5,b[p++]=h+3,b[p++]=h+5,b[p++]=h+6,b[p++]=h+3}}return{vertexData:M,indexData:b}}const C=[];function D(t,e){if(0===C.length)for(let c=0;c<30;c++)C.push(v(5*c,0,!e.invertDirection));const n=u(h.fromJSON(e.inputUnit),"knots"),{width:i,height:a,mask:s}=t,r=t.pixels[0],o=t.pixels[1],l=6,f=[],p=[];let d=0,m=0;for(let h=0;h<a;h++)for(let t=0;t<i;t++){const e=h*i+t,u=r[e]*n;if((!s||s[h*i+t])&&u>=c){const n=(o[e]+360)%360/180*Math.PI,{pennants:s,barbs:r,shaft:c}=C[Math.min(Math.floor(u/5),29)];if(s.length+r.length===0)continue;let x=f.length/l;const g=(t+.5)/i,y=(h+.5)/a;for(let t=0;t<s.length;t+=2)f[d++]=g,f[d++]=y,f[d++]=s[t],f[d++]=s[t+1]+n,f[d++]=0,f[d++]=u;for(let t=0;t<r.length;t+=2)f[d++]=g,f[d++]=y,f[d++]=r[t],f[d++]=r[t+1]+n,f[d++]=0,f[d++]=u;for(let t=0;t<c.length;t+=2)f[d++]=g,f[d++]=y,f[d++]=c[t],f[d++]=c[t+1]+n,f[d++]=0,f[d++]=u;for(let t=0;t<s.length/6;t++)p[m++]=x,p[m++]=x+1,p[m++]=x+2,x+=3;for(let t=0;t<r.length/8;t++)p[m++]=x,p[m++]=x+1,p[m++]=x+2,p[m++]=x+1,p[m++]=x+2,p[m++]=x+3,x+=4;p[m++]=x+0,p[m++]=x+1,p[m++]=x+2,p[m++]=x+1,p[m++]=x+3,p[m++]=x+2,x+=4}}return{vertexData:new Float32Array(f),indexData:new Uint32Array(p)}}function I(t,e){const n=24;let i=0,a=0;const{width:s,height:r,mask:o}=t,l=t.pixels[0],f=[],p=[],d=u(h.fromJSON(e.inputUnit),"knots"),m="wind_speed"===e.style?c:Number.MAX_VALUE;for(let c=0;c<r;c++)for(let t=0;t<s;t++){const e=l[c*s+t]*d;if((!o||o[c*s+t])&&e<m){for(let n=0;n<4;n++)f[i++]=(t+.5)/s,f[i++]=(c+.5)/r,f[i++]=n<2?-.5:.5,f[i++]=n%2==0?-.5:.5,f[i++]=0,f[i++]=e;const o=4*(i/n-1);p[a++]=o,p[a++]=o+1,p[a++]=o+2,p[a++]=o+1,p[a++]=o+2,p[a++]=o+3}}return{vertexData:new Float32Array(f),indexData:new Uint32Array(p)}}function T(t,e){return"simple_scalar"===e.style?I(t,e):"wind_speed"===e.style?D(t,e):A(t,e)}function F(t,e,n,i=[0,0],a=.5){const{width:r,height:o,mask:l}=t,[c,h]=t.pixels,[u,f]=i,m=Math.round((r-u)/n),x=Math.round((o-f)/n),g=m*x,y=new Float32Array(g),_=new Float32Array(g),w=new Uint8Array(g),v="vector-uv"===e;for(let s=0;s<x;s++)for(let t=0;t<m;t++){let e=0;const i=s*m+t,x=Math.max(0,s*n+f),g=Math.max(0,t*n+u),M=Math.min(o,x+n),b=Math.min(r,g+n);for(let t=x;t<M;t++)for(let n=g;n<b;n++){const a=t*r+n;if(!l||l[a]){e++;const t=v?[c[a],h[a]]:[c[a],(360+h[a])%360],[n,s]=v?t:d(t);y[i]+=n,_[i]+=s}}if(e>=(M-x)*(b-g)*(1-a)){w[i]=1;const[t,n]=p([y[i]/e,_[i]/e]);y[i]=t,_[i]=n}else w[i]=0,y[i]=0,_[i]=0}const M=new s.Z({width:m,height:x,pixels:[y,_],mask:w});return M.updateStatistics(),M}},20980:function(t,e,n){n.d(e,{Z:function(){return _t}});var i=n(36663),a=n(80085),s=n(53280),r=n(76868),o=n(81977),l=(n(7753),n(7283),n(40266)),c=n(61681),h=n(95550);function u(t){const e=f(m(t)),n=e,i=!0,a=Math.max(e/2,5),s=Math.round((0,h.F2)(t.maxPathLength)/a)+1,r=10,{density:o}=t;return{smoothing:(0,h.F2)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:s,minSpeedThreshold:.001,segmentLength:a,maxTurnAngle:1,collisions:i,lineCollisionWidth:n,lineSpacing:r,density:o}}function f(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function p(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function d(t){return{kind:"constant",value:[.1,.1,.1,1]}}function m(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,h.F2)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],n=[],i=[];let a;if(e.stops){for(const t of e.stops)n.push(t.value),i.push((0,h.F2)(t.size));a=e.stops.length}else n.push(e.minDataValue,e.maxDataValue),i.push((0,h.F2)(e.minSize),(0,h.F2)(e.maxSize)),a=2;return{kind:"ramp",stops:n,values:i,count:a}}function x(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:p(t.color)};const e=t.getVisualVariablesForType("color")[0],n=[],i=[];for(const a of e.stops)n.push(a.value),Array.prototype.push.apply(i,p(a.color));return{kind:"ramp",stops:n,values:i,count:e.stops.length}}function g(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const a of e.stops)n.push(a.value),i.push(a.opacity);return{kind:"ramp",stops:n,values:i,count:e.stops.length}}function y(t,e,n,i){switch(e){case"int":t.setUniform1iv(n,i);break;case"float":t.setUniform1fv(n,i);break;case"vec2":t.setUniform2fv(n,i);break;case"vec3":t.setUniform3fv(n,i);break;case"vec4":t.setUniform4fv(n,i)}}function _(t,e,n,i){"constant"===i.kind?y(t,n,`u_${e}`,i.value):(y(t,"float",`u_${e}_stops`,i.stops),y(t,n,`u_${e}_values`,i.values),t.setUniform1i(`u_${e}_count`,i.count))}function w(t,e){let n=!0;return n=n&&t.collisions===e.collisions,n=n&&t.density===e.density,n=n&&t.interpolate===e.interpolate,n=n&&t.lineCollisionWidth===e.lineCollisionWidth,n=n&&t.lineSpacing===e.lineSpacing,n=n&&t.maxTurnAngle===e.maxTurnAngle,n=n&&t.minSpeedThreshold===e.minSpeedThreshold,n=n&&t.segmentLength===e.segmentLength,n=n&&t.smoothing===e.smoothing,n=n&&t.velocityScale===e.velocityScale,n=n&&t.verticesPerLine===e.verticesPerLine,n}function v(t,e){return t===e||!(!(0,c.pC)(t)||!(0,c.pC)(e))&&t.equals(e)}function M(t,e){if(!w(t.simulationSettings,e.simulationSettings))return!1;if(!v(t.timeExtent,e.timeExtent))return!1;let n=!0;return n=n&&t.loadImagery===e.loadImagery,n=n&&t.createFlowMesh===e.createFlowMesh,n=n&&t.color.kind===e.color.kind,n=n&&t.opacity.kind===e.opacity.kind,n=n&&t.size.kind===e.size.kind,n}var b=n(78668),S=n(78951),k=n(91907),R=n(43487),P=n(29620),A=n(41163);class C{constructor(t){this._params=t,this.animated=!1}isCompatible(t){if(!(t instanceof C))return!1;if(!v(this._params.timeExtent,t._params.timeExtent))return!1;let e=!0;return e=e&&this._params.loadImagery===t._params.loadImagery,e=e&&this._params.color.kind===t._params.color.kind,e=e&&this._params.opacity.kind===t._params.opacity.kind,e}async load(t,e){const{extent:n,size:i}=t;(0,b.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e);return new F(a,{color:this._params.color,opacity:this._params.opacity})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(k.zi.ONE,k.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),i.bindTexture(n.texture,0),a.setUniform1i("u_texture",0),a.setUniform1f("u_Min",n.min),a.setUniform1f("u_Max",n.max),_(a,"color","vec4",this._params.color),_(a,"opacity","float",this._params.opacity),i.bindVAO(n.vertexArray),i.drawArrays(k.MX.TRIANGLE_STRIP,0,4)}}const D=new Map;D.set("a_position",0),D.set("a_texcoord",1);const I={geometry:[new A.G("a_position",2,k.g.UNSIGNED_SHORT,0,8),new A.G("a_texcoord",2,k.g.UNSIGNED_SHORT,4,8)]},T={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",attributes:D};class F{constructor(t,e){this._flowData=t,this._values=e}attach(t){const{context:e}=t,{width:n,height:i}=this._flowData,a=S.f.createVertex(e,k.l1.STATIC_DRAW,new Uint16Array([0,0,0,1,n,0,1,1,0,i,0,0,n,i,1,0])),s=new P.U(e,D,I,{geometry:a}),r=[];"ramp"===this._values.color.kind&&r.push("vvColor"),"ramp"===this._values.opacity.kind&&r.push("vvOpacity");const o=t.painter.materialManager.getProgram(T,r);let l=1e6,c=-1e6;for(let f=0;f<i;f++)for(let t=0;t<n;t++)if(0!==this._flowData.mask[f*n+t]){const e=this._flowData.data[2*(f*n+t)+0],i=this._flowData.data[2*(f*n+t)+1],a=Math.sqrt(e*e+i*i);l=Math.min(l,a),c=Math.max(c,a)}const h=new Uint8Array(4*n*i);for(let f=0;f<i;f++)for(let t=0;t<n;t++)if(0!==this._flowData.mask[f*n+t]){const e=this._flowData.data[2*(f*n+t)+0],i=this._flowData.data[2*(f*n+t)+1],a=(Math.sqrt(e*e+i*i)-l)/(c-l);h[4*(f*n+t)+0]=255*a,h[4*(f*n+t)+1]=0,h[4*(f*n+t)+2]=0,h[4*(f*n+t)+3]=255}else h[4*(f*n+t)+0]=0,h[4*(f*n+t)+1]=0,h[4*(f*n+t)+2]=0,h[4*(f*n+t)+3]=0;const u=new R.x(e,{pixelFormat:k.VI.RGBA,internalFormat:k.VI.RGBA,samplingMode:k.cw.LINEAR,dataType:k.Br.UNSIGNED_BYTE,wrapMode:k.e8.CLAMP_TO_EDGE,flipped:!0,width:n,height:i},h);this.vertexArray=s,this.program=o,this.texture=u,this.min=l,this.max=c,this._flowData=null}detach(){this.vertexArray.dispose(),this.texture.dispose()}get ready(){return this.program.isCompiled}}class E{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof E&&M(this._params,t._params)}async load(t,e){const{extent:n,size:i}=t;(0,b.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e),{vertexData:s,indexData:r}=await this._params.createFlowMesh("Particles",this._params.simulationSettings,a,e);return new N(s,r,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(k.zi.ONE,k.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniform1f("u_time",e.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),_(a,"color","vec4",this._params.color),_(a,"opacity","float",this._params.opacity),_(a,"size","float",this._params.size),i.bindVAO(n.vertexArray),i.drawElements(k.MX.TRIANGLES,n.indexCount,k.g.UNSIGNED_INT,0)}}const z=new Map;z.set("a_xyts0",0),z.set("a_xyts1",1),z.set("a_typeIdDurationSeed",2),z.set("a_extrudeInfo",3);const V={geometry:[new A.G("a_xyts0",4,k.g.FLOAT,0,64),new A.G("a_xyts1",4,k.g.FLOAT,16,64),new A.G("a_typeIdDurationSeed",4,k.g.FLOAT,32,64),new A.G("a_extrudeInfo",4,k.g.FLOAT,48,64)]},O={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:z};class N{constructor(t,e,n){this._vertexData=t,this._indexData=e,this._values=n}attach(t){const{context:e}=t,n=S.f.createVertex(e,k.l1.STATIC_DRAW,this._vertexData),i=S.f.createIndex(e,k.l1.STATIC_DRAW,this._indexData),a=new P.U(e,z,V,{geometry:n},i),s=[];"ramp"===this._values.color.kind&&s.push("vvColor"),"ramp"===this._values.opacity.kind&&s.push("vvOpacity"),"ramp"===this._values.size.kind&&s.push("vvSize");const r=t.painter.materialManager.getProgram(O,s);this.vertexArray=a,this.program=r,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}class U{constructor(t){this._styles=t}get animated(){return this._styles.reduce(((t,e)=>t||e.animated),!1)}isCompatible(t){if(!(t instanceof U))return!1;if(this._styles.length!==t._styles.length)return!1;const e=this._styles.length;for(let n=0;n<e;n++)if(!this._styles[n].isCompatible(t._styles[n]))return!1;return!0}async load(t,e){const n=await Promise.all(this._styles.map((n=>n.load(t,e))));return new G(n)}render(t,e,n){for(let i=0;i<this._styles.length;i++)this._styles[i].render(t,e,n.resources[i])}}class G{constructor(t){this.resources=t}attach(t){for(const e of this.resources)e.attach(t)}detach(){for(const t of this.resources)t.detach()}get ready(){return this.resources.reduce(((t,e)=>t&&e.ready),!0)}}class L{constructor(t){this._params=t}get animated(){return this._params.flowSpeed>0}isCompatible(t){return t instanceof L&&M(this._params,t._params)}async load(t,e){const{extent:n,size:i}=t;(0,b.k_)(e);const a=await this._params.loadImagery(n,i[0],i[1],this._params.timeExtent,e),{vertexData:s,indexData:r}=await this._params.createFlowMesh("Streamlines",this._params.simulationSettings,a,e);return new B(s,r,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})}render(t,e,n){const{context:i}=t,{program:a}=n;i.setFaceCullingEnabled(!1),i.setBlendingEnabled(!0),i.setBlendFunction(k.zi.ONE,k.zi.ONE_MINUS_SRC_ALPHA),i.useProgram(a),a.setUniform1f("u_time",e.time),a.setUniform1f("u_trailLength",this._params.trailLength),a.setUniform1f("u_flowSpeed",this._params.flowSpeed),a.setUniform1f("u_featheringSize",this._params.featheringSize),a.setUniform1f("u_featheringOffset",this._params.featheringOffset),a.setUniform1f("u_introFade",this._params.introFade?1:0),a.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0),a.setUniform1f("u_decayRate",this._params.decayRate),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),a.setUniformMatrix3fv("u_displayViewMat3",e.displayViewMat3),_(a,"color","vec4",this._params.color),_(a,"opacity","float",this._params.opacity),_(a,"size","float",this._params.size),i.bindVAO(n.vertexArray),i.drawElements(k.MX.TRIANGLES,n.indexCount,k.g.UNSIGNED_INT,0)}}const W=new Map;W.set("a_positionAndSide",0),W.set("a_timeInfo",1),W.set("a_extrude",2),W.set("a_speed",3);const Z={geometry:[new A.G("a_positionAndSide",3,k.g.FLOAT,0,36),new A.G("a_timeInfo",3,k.g.FLOAT,12,36),new A.G("a_extrude",2,k.g.FLOAT,24,36),new A.G("a_speed",1,k.g.FLOAT,32,36)]},q={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:W};class B{constructor(t,e,n){this._vertexData=t,this._indexData=e,this._values=n}attach(t){const{context:e}=t,n=S.f.createVertex(e,k.l1.STATIC_DRAW,this._vertexData),i=S.f.createIndex(e,k.l1.STATIC_DRAW,this._indexData),a=new P.U(e,W,Z,{geometry:n},i),s=[];"ramp"===this._values.color.kind&&s.push("vvColor"),"ramp"===this._values.opacity.kind&&s.push("vvOpacity"),"ramp"===this._values.size.kind&&s.push("vvSize");const r=t.painter.materialManager.getProgram(q,s);this.vertexArray=a,this.program=r,this.indexCount=this._indexData.length,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose()}get ready(){return this.program.isCompiled}}const j=4,K=1,Y=.5,H=!0,J=!0,X=2.3;function Q(t,e){const{flowSpeed:n,trailLength:i}=t,a=u(t);let s=null;const r={opacity:g(t),size:m(t)};let o=x(t);if("none"===t.background)r.color=o;else{"constant"===o.kind&&(o={kind:"ramp",stops:[0,1],values:[0,0,0,1,o.value[0],o.value[1],o.value[2],o.value[3]],count:2});const t={loadImagery:e.loadImagery,timeExtent:e.timeExtent,color:o,opacity:{kind:"constant",value:[1]}};s=new C(t),r.color=d()}const l={loadImagery:e.loadImagery,createFlowMesh:e.createFlowMesh,simulationSettings:a,timeExtent:e.timeExtent,trailLength:i,flowSpeed:n,featheringSize:K,featheringOffset:Y,introFade:H,fadeToZero:J,decayRate:X,color:r.color,opacity:r.opacity,size:r.size},h="butt"===t.trailCap||f(m(t))<=j?new L(l):new E(l);return(0,c.pC)(s)?new U([s,h]):h}var $=n(88243),tt=n(87808),et=n(38716),nt=n(2443);class it extends nt.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(t){super.doRender(t)}prepareRenderPasses(t){const e=t.registerRenderPass({name:"flow",brushes:[tt.Z],target:()=>this.children,drawPhase:et.jx.MAP});return[...super.prepareRenderPasses(t),e]}}n(91957);var at=n(53404),st=n(13802),rt=n(19431),ot=n(70909);class lt{constructor(t,e,n,i){this.state={name:"created"},this.flowStyle=t,this.extent=e,this.size=n,this.pixelRatio=i}async load(){const t=new AbortController;this.state={name:"loading",abortController:t};const e={extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},n=await this.flowStyle.load(e,t.signal);this.state={name:"loaded",resources:n}}attach(t){if("loaded"!==this.state.name)return void st.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");const e=this.state.resources;e.attach(t),this.state={name:"attached",resources:e}}detach(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(t){return!!this.flowStyle.isCompatible(t.flowStyle)&&(!(!this.extent.equals(t.extent)||this.size[0]!==t.size[0]||this.size[1]!==t.size[1]||this.pixelRatio!==t.pixelRatio)&&(this.flowStyle=t.flowStyle,!0))}}var ct=n(1662),ht=n(19710),ut=n(51118);class ft extends ut.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(t){this._displayData=t,this.requestRender()}clear(){(0,c.pC)(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())}setTransform(t){const{displayData:e}=this;if((0,c.Wi)(e))return;const n=e.extent.xmin,i=e.extent.ymax,a=[0,0];t.toScreen(a,[n,i]);const s=(e.extent.xmax-e.extent.xmin)/e.size[0]/t.resolution,r=(0,rt.Vl)(t.rotation),{dvs:o}=this.transforms;(0,ct.j)(o,[-1,1,0]),(0,ct.d)(o,o,[2/(t.size[0]*t.pixelRatio),-2/(t.size[1]*t.pixelRatio),1]),(0,ct.h)(o,o,[a[0],a[1],0]),(0,ct.r)(o,o,r),(0,ct.d)(o,o,[s*t.pixelRatio,s*t.pixelRatio,1])}_createTransforms(){return{dvs:(0,ht.c)()}}}var pt=n(91772);const dt=1.15;let mt=class extends at.Z{constructor(t){super(t),this._flowDisplayObject=new ft,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if((0,c.Wi)(e))return void this._clear();const{extent:n,rotation:i,resolution:a,pixelRatio:s}=t.state,r=gt(n,i);r.expand(dt);const o=[Math.round((r.xmax-r.xmin)/a),Math.round((r.ymax-r.ymin)/a)],l=new lt(e,r,o,s);if((0,c.pC)(this._loading)){if(this._loading.update(l))return;this._loading.detach(),this._loading=null}!(0,c.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(t=>{(0,b.D_)(t)||(st.Z.getLogger(this.declaredClass).error("A resource failed to load.",t),this._loading=null)})),this._loading=l)}_clear(){this._flowDisplayObject.clear(),(0,c.pC)(this._loading)&&(this._loading.detach(),this._loading=null)}};(0,i._)([(0,o.Cb)()],mt.prototype,"_loading",void 0),(0,i._)([(0,o.Cb)()],mt.prototype,"flowContainer",void 0),(0,i._)([(0,o.Cb)()],mt.prototype,"updating",null),mt=(0,i._)([(0,l.j)("esri.views.2d.engine.flow.FlowStrategy")],mt);const xt=mt;function gt(t,e){const n=new ot.Z({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),i=t.xmax-t.xmin,a=t.ymax-t.ymin,s=Math.abs(Math.cos((0,rt.Vl)(e))),r=Math.abs(Math.sin((0,rt.Vl)(e))),o=s*i+r*a,l=r*i+s*a,c=new pt.Z({xmin:n.x-o/2,ymin:n.y-l/2,xmax:n.x+o/2,ymax:n.y+l/2,spatialReference:t.spatialReference});return c.centerAt(n),c}let yt=class extends s.r{constructor(){super(...arguments),this._loadImagery=(t,e,n,i,a)=>(0,$.KK)(this.layer,t,e,n,i,a),this._createFlowMesh=(t,e,n,i)=>this.layer.createFlowMesh({meshType:t,flowData:n,simulationSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,n,i,a,s)=>(0,$.KK)(t,e,n,i,a,s),this._updateVisualization()};"multidimensionalDefinition"in t?this.handles.add((0,r.YP)((()=>t.multidimensionalDefinition),e)):this.handles.add([(0,r.YP)((()=>t.mosaicRule),e),(0,r.YP)((()=>t.renderingRule),e),(0,r.YP)((()=>t.definitionExpression),e)]),this.container=new it,this._strategy=new xt({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new a.Z({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const{renderer:t}=this.layer;if("flow"!==t.type)return;const e=Q(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,i._)([(0,o.Cb)()],yt.prototype,"_strategy",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"attached",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"container",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"layer",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"layerView",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"type",void 0),(0,i._)([(0,o.Cb)()],yt.prototype,"updating",null),(0,i._)([(0,o.Cb)()],yt.prototype,"timeExtent",void 0),yt=(0,i._)([(0,l.j)("esri.views.2d.engine.flow.FlowView2D")],yt);const _t=yt},88243:function(t,e,n){n.d(e,{GE:function(){return p},KK:function(){return M}});n(91957);var i=n(39994),a=n(13802),s=n(19431),r=n(61681),o=n(78668),l=n(4157),c=n(35925),h=n(91772);const u=a.Z.getLogger("esri.views.2d.engine.flow.dataUtils"),f=10;async function p(t,e,n,a){const s=performance.now(),r=d(e,n),l=performance.now(),c=x(e,r,n.width,n.height),h=performance.now(),p=y(c,!0),m=performance.now(),g="Streamlines"===t?_(p,f):w(p),v=performance.now();return(0,i.Z)("esri-2d-profiler")&&(u.info("I.1","_createFlowFieldFromData (ms)",Math.round(l-s)),u.info("I.2","_getStreamlines (ms)",Math.round(h-l)),u.info("I.3","createAnimatedLinesData (ms)",Math.round(m-h)),u.info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(v-m)),u.info("I.5","createFlowMesh (ms)",Math.round(v-s)),u.info("I.6","Mesh size (bytes)",g.vertexData.buffer.byteLength+g.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.k_)(a),g}function d(t,e){const n=g(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,i)=>{const a=Math.floor(t),s=Math.floor(i);if(a<0||a>=e.width)return[0,0];if(s<0||s>=e.height)return[0,0];const r=t-a,o=i-s,l=a,c=s,h=a<e.width-1?a+1:a,u=s<e.height-1?s+1:s,f=n[2*(c*e.width+l)],p=n[2*(c*e.width+h)],d=n[2*(u*e.width+l)],m=n[2*(u*e.width+h)],x=n[2*(c*e.width+l)+1],g=n[2*(c*e.width+h)+1];return[(f*(1-o)+d*o)*(1-r)+(p*(1-o)+m*o)*r,(x*(1-o)+n[2*(u*e.width+l)+1]*o)*(1-r)+(g*(1-o)+n[2*(u*e.width+h)+1]*o)*r]}:(t,i)=>{const a=Math.round(t),s=Math.round(i);return a<0||a>=e.width||s<0||s>=e.height?[0,0]:[n[2*(s*e.width+a)+0],n[2*(s*e.width+a)+1]]}}function m(t,e,n,i,a,s,r,o,l){const c=[];let h=n,u=i,f=0,[p,d]=e(h,u);p*=t.velocityScale,d*=t.velocityScale;const m=Math.sqrt(p*p+d*d);let x,g;c.push({x:h,y:u,t:f,speed:m});for(let y=0;y<t.verticesPerLine;y++){let[n,i]=e(h,u);n*=t.velocityScale,i*=t.velocityScale;const p=Math.sqrt(n*n+i*i);if(p<t.minSpeedThreshold)return c;const d=n/p,m=i/p;if(h+=d*t.segmentLength,u+=m*t.segmentLength,f+=t.segmentLength/p,Math.acos(d*x+m*g)>t.maxTurnAngle)return c;if(t.collisions){const t=Math.round(h*l),e=Math.round(u*l);if(t<0||t>r-1||e<0||e>o-1)return c;const n=s[e*r+t];if(-1!==n&&n!==a)return c;s[e*r+t]=a}c.push({x:h,y:u,t:f,speed:p}),x=d,g=m}return c}function x(t,e,n,i){const a=[],s=new l.Z,r=1/Math.max(t.lineCollisionWidth,1),o=Math.round(n*r),c=Math.round(i*r),h=new Int32Array(o*c);for(let l=0;l<h.length;l++)h[l]=-1;const u=[];for(let l=0;l<i;l+=t.lineSpacing)for(let e=0;e<n;e+=t.lineSpacing)u.push({x:e,y:l,sort:s.getFloat()});u.sort(((t,e)=>t.sort-e.sort));for(const{x:l,y:f}of u)if(s.getFloat()<t.density){const n=m(t,e,l,f,a.length,h,o,c,r);if(n.length<2)continue;a.push(n)}return a}function g(t,e,n,i){if(0===i)return t;const a=Math.round(3*i),s=new Array(2*a+1);let r=0;for(let c=-a;c<=a;c++){const t=Math.exp(-c*c/(i*i));s[c+a]=t,r+=t}for(let c=-a;c<=a;c++)s[c+a]/=r;const o=new Float32Array(t.length);for(let c=0;c<n;c++)for(let n=0;n<e;n++){let i=0,r=0;for(let o=-a;o<=a;o++){if(n+o<0||n+o>=e)continue;const l=s[o+a];i+=l*t[2*(c*e+(n+o))+0],r+=l*t[2*(c*e+(n+o))+1]}o[2*(c*e+n)+0]=i,o[2*(c*e+n)+1]=r}const l=new Float32Array(t.length);for(let c=0;c<e;c++)for(let t=0;t<n;t++){let i=0,r=0;for(let l=-a;l<=a;l++){if(t+l<0||t+l>=n)continue;const h=s[l+a];i+=h*o[2*((t+l)*e+c)+0],r+=h*o[2*((t+l)*e+c)+1]}l[2*(t*e+c)+0]=i,l[2*(t*e+c)+1]=r}return l}function y(t,e){const n=new l.Z,i=t.reduce(((t,e)=>t+e.length),0),a=new Float32Array(4*i),s=new Array(t.length);let r=0,o=0;for(const l of t){const t=r;for(const e of l)a[4*r+0]=e.x,a[4*r+1]=e.y,a[4*r+2]=e.t,a[4*r+3]=e.speed,r++;s[o++]={startVertex:t,numberOfVertices:l.length,totalTime:l[l.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:a,lineDescriptors:s}}function _(t,e){const n=9,{lineVertices:i,lineDescriptors:a}=t;let s=0,r=0;for(const p of a)s+=2*p.numberOfVertices,r+=6*(p.numberOfVertices-1);const o=new Float32Array(s*n),l=new Uint32Array(r);let c=0,h=0;function u(){l[h++]=c-2,l[h++]=c,l[h++]=c-1,l[h++]=c,l[h++]=c+1,l[h++]=c-1}function f(t,e,i,a,s,r,l,h){const u=c*n;let f=0;o[u+f++]=t,o[u+f++]=e,o[u+f++]=1,o[u+f++]=i,o[u+f++]=r,o[u+f++]=l,o[u+f++]=a/2,o[u+f++]=s/2,o[u+f++]=h,c++,o[u+f++]=t,o[u+f++]=e,o[u+f++]=-1,o[u+f++]=i,o[u+f++]=r,o[u+f++]=l,o[u+f++]=-a/2,o[u+f++]=-s/2,o[u+f++]=h,c++}for(const p of a){const{totalTime:t,timeSeed:n}=p;let a=null,s=null,r=null,o=null,l=null,c=null;for(let h=0;h<p.numberOfVertices;h++){const d=i[4*(p.startVertex+h)+0],m=i[4*(p.startVertex+h)+1],x=i[4*(p.startVertex+h)+2],g=i[4*(p.startVertex+h)+3];let y=null,_=null,w=null,v=null;if(h>0){y=d-a,_=m-s;const i=Math.sqrt(y*y+_*_);if(y/=i,_/=i,h>1){let t=y+l,n=_+c;const i=Math.sqrt(t*t+n*n);t/=i,n/=i;const a=Math.min(1/(t*y+n*_),e);t*=a,n*=a,w=-n,v=t}else w=-_,v=y;null!==w&&null!==v&&(f(a,s,r,w,v,t,n,g),u())}a=d,s=m,r=x,l=y,c=_,o=g}f(a,s,r,-c,l,t,n,o)}return{vertexData:o,indexData:l}}function w(t){const e=16,n=1,i=2,{lineVertices:a,lineDescriptors:s}=t;let r=0,o=0;for(const I of s){const t=I.numberOfVertices-1;r+=4*t*2,o+=6*t*2}const l=new Float32Array(r*e),c=new Uint32Array(o);let h,u,f,p,d,m,x,g,y,_,w,v,M,b,S=0,k=0;function R(){c[k++]=S-8,c[k++]=S-7,c[k++]=S-6,c[k++]=S-7,c[k++]=S-5,c[k++]=S-6,c[k++]=S-4,c[k++]=S-3,c[k++]=S-2,c[k++]=S-3,c[k++]=S-1,c[k++]=S-2}function P(t,a,s,r,o,c,h,u,f,p,d,m,x,g){const y=S*e;let _=0;for(const e of[n,i])for(const n of[1,2,3,4])l[y+_++]=t,l[y+_++]=a,l[y+_++]=s,l[y+_++]=r,l[y+_++]=h,l[y+_++]=u,l[y+_++]=f,l[y+_++]=p,l[y+_++]=e,l[y+_++]=n,l[y+_++]=x,l[y+_++]=g,l[y+_++]=o/2,l[y+_++]=c/2,l[y+_++]=d/2,l[y+_++]=m/2,S++}function A(t,e){let n=y+w,i=_+v;const a=Math.sqrt(n*n+i*i);n/=a,i/=a;const s=y*n+_*i;n/=s,i/=s;let r=w+M,o=v+b;const l=Math.sqrt(r*r+o*o);r/=l,o/=l;const c=w*r+v*o;r/=c,o/=c,P(h,u,f,p,-i,n,d,m,x,g,-o,r,t,e),R()}function C(t,e,n,i,a,s){if(y=w,_=v,w=M,v=b,null==y&&null==_&&(y=w,_=v),null!=d&&null!=m){M=t-d,b=e-m;const n=Math.sqrt(M*M+b*b);M/=n,b/=n}null!=y&&null!=_&&A(a,s),h=d,u=m,f=x,p=g,d=t,m=e,x=n,g=i}function D(t,e){y=w,_=v,w=M,v=b,null==y&&null==_&&(y=w,_=v),null!=y&&null!=_&&A(t,e)}for(const I of s){h=null,u=null,f=null,p=null,d=null,m=null,x=null,g=null,y=null,_=null,w=null,v=null,M=null,b=null;const{totalTime:t,timeSeed:e}=I;for(let n=0;n<I.numberOfVertices;n++)C(a[4*(I.startVertex+n)+0],a[4*(I.startVertex+n)+1],a[4*(I.startVertex+n)+2],a[4*(I.startVertex+n)+3],t,e);D(t,e)}return{vertexData:l,indexData:c}}function v(t,e){const n=e.pixels,{width:i,height:a}=e,r=new Float32Array(i*a*2),o=e.mask||new Uint8Array(i*a*2);if(e.mask||o.fill(255),"vector-uv"===t)for(let s=0;s<i*a;s++)r[2*s+0]=n[0][s],r[2*s+1]=-n[1][s];else if("vector-magdir"===t)for(let l=0;l<i*a;l++){const t=n[0][l],e=(0,s.Vl)(n[1][l]),i=Math.cos(e-Math.PI/2),a=Math.sin(e-Math.PI/2);r[2*l+0]=i*t,r[2*l+1]=a*t}return{data:r,mask:o,width:i,height:a}}async function M(t,e,n,a,s,r){const o=performance.now(),l=(0,c.C5)(e.spatialReference);if(!l){const l=await b(t,e,n,a,s,r);return(0,i.Z)("esri-2d-profiler")&&u.info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-o)),(0,i.Z)("esri-2d-profiler")&&u.info("I.9","Number of parts",1),l}const[f,p]=l.valid,d=p-f,m=Math.ceil(e.width/d),x=e.width/m,g=Math.round(n/m);let y=e.xmin;const _=[],w=performance.now();for(let i=0;i<m;i++){const n=new h.Z({xmin:y,xmax:y+x,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});_.push(b(t,n,g,a,s,r)),y+=x}const v=await Promise.all(_);(0,i.Z)("esri-2d-profiler")&&u.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-w)),(0,i.Z)("esri-2d-profiler")&&u.info("I.9","Number of parts",v.length);const M={data:new Float32Array(n*a*2),mask:new Uint8Array(n*a),width:n,height:a};let S=0;for(const i of v){for(let t=0;t<i.height;t++)for(let e=0;e<i.width;e++)S+e>=n||(M.data[2*(t*n+S+e)+0]=i.data[2*(t*i.width+e)+0],M.data[2*(t*n+S+e)+1]=i.data[2*(t*i.width+e)+1],M.mask[t*n+S+e]=i.mask[t*i.width+e]);S+=i.width}return(0,i.Z)("esri-2d-profiler")&&u.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-o)),M}async function b(t,e,n,i,a,s){const o={requestProjectedLocalDirections:!0,signal:s};if((0,r.pC)(a)&&(o.timeExtent=a),"imagery"===t.type){await t.load({signal:s});const a=t.rasterInfo.dataType,l=await t.fetchImage(e,n,i,o);return!l||(0,r.Wi)(l.pixelData)||(0,r.Wi)(l.pixelData.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:v(a,l.pixelData.pixelBlock)}await t.load({signal:s});const l=t.rasterInfo.dataType,c=await t.fetchPixels(e,n,i,o);return!c||(0,r.Wi)(c.pixelBlock)?{data:new Float32Array(n*i*2),mask:new Uint8Array(n*i),width:n,height:i}:v(l,c.pixelBlock)}},84557:function(t,e,n){n.d(e,{F:function(){return p}});n(39994);var i=n(61681),a=n(1662),s=n(19710),r=n(55542),o=n(7928),l=n(51118),c=n(77801),h=n(78951),u=n(91907),f=n(29620);class p extends l.s{constructor(t=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=t}destroy(){(0,i.pC)(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(t){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(t)&&(this._symbolizerParameters=t,this.invalidateVAO())}get source(){return this._source}set source(t){this._source=t,this.invalidateVAO()}invalidateVAO(){!this._vaoInvalidated&&(0,i.pC)(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(t){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,i.pC)(this.source)&&(0,i.Wi)(this.vaoData)){const{style:e}=this.symbolizerParameters;switch(e){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const e=(0,o.wF)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e);this.vaoData={magdir:n}}break;case"simple_scalar":{const e=(0,o.K)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e);this.vaoData={scalar:n}}break;case"wind_speed":{const e=(0,o.wF)(this.source,this.symbolizerParameters),n=this._createVectorFieldVAO(t.context,e),i=(0,o.K)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(t.context,i);this.vaoData={magdir:n,scalar:a}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,s.c)()}}setTransform(t){const e=(0,a.g)(this.transforms.dvs),[n,i]=t.toScreenNoRotation([0,0],[this.x,this.y]),s=this.resolution/this.pixelRatio/t.resolution,o=s*this.width,l=s*this.height,c=Math.PI*this.rotation/180;(0,a.h)(e,e,(0,r.f)(n,i)),(0,a.h)(e,e,(0,r.f)(o/2,l/2)),(0,a.r)(e,e,-c),(0,a.h)(e,e,(0,r.f)(-o/2,-l/2)),(0,a.k)(e,e,(0,r.f)(o,l)),(0,a.m)(this.transforms.dvs,t.displayViewMat3,e)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(t,e){const{vertexData:n,indexData:i}=e,a=h.f.createVertex(t,u.l1.STATIC_DRAW,new Float32Array(n)),s=h.f.createIndex(t,u.l1.STATIC_DRAW,new Uint32Array(i)),r=(0,c.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:u.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:u.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:u.g.FLOAT,normalized:!1}]});return{vao:new f.U(t,r.attributes,r.bufferLayouts,{geometry:a},s),elementCount:i.length}}}},59439:function(t,e,n){n.d(e,{V:function(){return r},e:function(){return s}});var i=n(61681),a=n(99294);async function s(t,e=t.popupTemplate){if((0,i.Wi)(e))return[];const n=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:s}=e,{objectIdField:r,typeIdField:o,globalIdField:l,relationships:c}=t;if(n.includes("*"))return["*"];const h=s?await(0,a.CH)(t):[],u=(0,a.Q0)(t.fieldsIndex,[...n,...h]);return o&&u.push(o),u&&r&&t.fieldsIndex.has(r)&&!u.includes(r)&&u.push(r),u&&l&&t.fieldsIndex.has(l)&&!u.includes(l)&&u.push(l),c&&c.forEach((e=>{const{keyField:n}=e;u&&n&&t.fieldsIndex.has(n)&&!u.includes(n)&&u.push(n)})),u}function r(t,e){return t.popupTemplate?t.popupTemplate:(0,i.pC)(e)&&e.defaultPopupTemplateEnabled&&(0,i.pC)(t.defaultPopupTemplate)?t.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=2945.aefdf7a9.js.map