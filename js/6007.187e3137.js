"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[6007],{91103:function(e,t,i){i.d(t,{CS:function(){return g},Cw:function(){return m},Yu:function(){return b},j5:function(){return y},lm:function(){return v}});var s=i(51366),n=i(88256),r=i(66636),o=i(66341),a=i(67134),l=i(3466),h=i(14685),c=i(37116),u=i(79880),p=i(72506),d=i(51211);const f={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function m(e){const t=e.folders||[],i=t.slice(),s=new Map,n=new Map,r=new Map,o=new Map,l=new Map,h={esriGeometryPoint:n,esriGeometryPolyline:r,esriGeometryPolygon:o};(e.featureCollection&&e.featureCollection.layers||[]).forEach((e=>{const t=(0,a.d9)(e);t.featureSet.features=[];const i=e.featureSet.geometryType;s.set(i,t);const l=e.layerDefinition.objectIdField;"esriGeometryPoint"===i?x(n,l,e.featureSet.features):"esriGeometryPolyline"===i?x(r,l,e.featureSet.features):"esriGeometryPolygon"===i&&x(o,l,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),t.forEach((t=>{t.networkLinkIds.forEach((s=>{const n=w(s,t.id,e.networkLinks);n&&i.push(n)}))})),i.forEach((e=>{if(e.featureInfos){e.points=(0,a.d9)(s.get("esriGeometryPoint")),e.polylines=(0,a.d9)(s.get("esriGeometryPolyline")),e.polygons=(0,a.d9)(s.get("esriGeometryPolygon")),e.mapImages=[];for(const t of e.featureInfos)switch(t.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const i=h[t.type].get(t.id);i&&e[f[t.type]].featureSet.features.push(i);break}case"GroundOverlay":{const i=l.get(t.id);i&&e.mapImages.push(i);break}}e.fullExtent=v([e])}}));const c=v(i);return{folders:t,sublayers:i,extent:c}}function g(e,t,i,r){const a=n.id&&n.id.findCredential(e);e=(0,l.fl)(e,{token:a&&a.token});const h=s.Z.kmlServiceUrl;return(0,o["default"])(h,{query:{url:e,model:"simple",folders:"",refresh:0!==i||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:r})}function y(e,t,i=null,s=[]){const n=[],r={},o=t.sublayers,a=t.folders.map((e=>e.id));return o.forEach((t=>{const o=new e;if(i?o.read(t,i):o.read(t),s.length&&a.includes(o.id)&&(o.visible=s.includes(o.id)),r[t.id]=o,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=r[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers.unshift(o)}else n.unshift(o)})),n}function x(e,t,i){i.forEach((i=>{e.set(i.attributes[t],i)}))}function _(e,t){let i;return t.some((t=>t.id===e&&(i=t,!0))),i}function w(e,t,i){const s=_(e,i);return s&&(s.parentFolderId=t,s.networkLink=s),s}async function b(e){const t=d["default"].fromJSON(e.featureSet).features,i=e.layerDefinition,s=(0,p.i)(i.drawingInfo.renderer),n=r.Z.fromJSON(e.popupInfo),o=[];for(const r of t){const e=await s.getSymbolAsync(r);r.symbol=e,r.popupTemplate=n,r.visible=!0,o.push(r)}return o}function v(e){const t=(0,c.Ue)(c.Gv),i=(0,c.Ue)(c.Gv);for(const s of e){if(s.polygons&&s.polygons.featureSet&&s.polygons.featureSet.features)for(const e of s.polygons.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.polylines&&s.polylines.featureSet&&s.polylines.featureSet.features)for(const e of s.polylines.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.points&&s.points.featureSet&&s.points.featureSet.features)for(const e of s.points.featureSet.features)(0,u.Yg)(t,e.geometry),(0,c.TC)(i,t);if(s.mapImages)for(const e of s.mapImages)(0,u.Yg)(t,e.extent),(0,c.TC)(i,t)}return(0,c.fS)(i,c.Gv)?null:{xmin:i[0],ymin:i[1],zmin:i[2],xmax:i[3],ymax:i[4],zmax:i[5],spatialReference:h.Z.WGS84}}},18486:function(e,t,i){i.d(t,{Hq:function(){return U},Mk:function(){return d},P_:function(){return F},Qp:function(){return Y},VO:function(){return C},_D:function(){return R},kZ:function(){return X},kr:function(){return $},nF:function(){return M},tB:function(){return Z},ut:function(){return L},vF:function(){return K},zD:function(){return S}});i(91957);var s,n=i(70375),r=i(61681),o=i(17321),a=i(96926),l=i(4757),h=i(91772),c=i(70909),u=i(89542),p=i(14685);function d(e,t,i){return!(0,l.Up)(e,t,i)}function f(e,t,i){const s=d(e,t,i);if(s&&!(0,l.kR)())throw new n.Z("rasterprojectionhelper-project","projection engine is not loaded");return s}!function(e){e[e.None=0]="None",e[e.North=1]="North",e[e.South=2]="South",e[e.Both=3]="Both"}(s||(s={}));const m=(e,t,i,s=0)=>{if(1===i[0])return[0,0];let n=1,r=-1,o=1,a=-1;for(let g=0;g<e.length;g+=2)isNaN(e[g])||(n=n>e[g]?e[g]:n,r=r>e[g]?r:e[g],o=o>e[g+1]?e[g+1]:o,a=a>e[g+1]?a:e[g+1]);const{cols:l,rows:h}=t,c=(r-n)/l/i[0],u=(a-o)/h/i[1],p=2*s;let d=0,f=!1,m=[0,0];for(let g=0;g<l-3;g++){for(let t=0;t<h-3;t++){const i=g*h*2+2*t,s=(e[i]+e[i+4]+e[i+4*h]+e[i+4*h+4])/4,n=(e[i+1]+e[i+5]+e[i+4*h+1]+e[i+4*h+5])/4,r=Math.abs((s-e[i+2*h+2])/c),o=Math.abs((n-e[i+2*h+3])/u);if(r+o>d&&(d=r+o,m=[r,o]),p&&d>p){f=!0;break}}if(f)break}return m},g={3395:20037508.342789244,3410:17334193.943686873,3857:20037508.342788905,3975:17367530.445161372,4087:20037508.342789244,4088:20015108.787169147,6933:17367530.445161372,32662:20037508.342789244,53001:20015086.79602057,53002:10007543.39801029,53003:20015086.79602057,53004:20015086.79602057,53016:14152803.599503474,53017:17333573.624304302,53034:20015086.79602057,53079:20015114.352186374,53080:20015114.352186374,54001:20037508.342789244,54002:10018754.171394624,54003:20037508.342789244,54004:20037508.342789244,54016:14168658.027268292,54017:17367530.44516137,54034:20037508.342789244,54079:20037508.342789244,54080:20037508.342789244,54100:20037508.342789244,54101:20037508.342789244},y=32,x=4,_=x,w=new Map,b=new Map,v=500;async function S(){(0,l.kR)()||await(0,l.zD)()}function R(e,t,i){return f(e.spatialReference,t)?i?(0,l.rS)(t,e.spatialReference,e):(0,l.rS)(e.spatialReference,t,e):null}function C(e,t,i,s=null){const n=e.spatialReference;if(n.equals(t))return e;f(n,t,s);const a=i.center,c=new h.Z({xmin:a.x-e.x/2,xmax:a.x+e.x/2,ymin:a.y-e.y/2,ymax:a.y+e.y/2,spatialReference:n}),u=(0,l.iV)(c,t,s),p=L(t);let d;if((0,r.Wi)(u)||(0,r.pC)(p)&&u.width>=p){const i=(0,o.c9)(n)/(0,o.c9)(t);d={x:e.x*i,y:e.y*i}}else d={x:u.width,y:u.height};return d}function P(e,t=.01){return(0,o.c9)(e)?t/(0,o.c9)(e):0}function M(e,t,i=null,s=!0){const n=e.spatialReference;if(n.equals(t))return e;f(n,t,i);const r=(0,l.iV)(e,t,i);return s&&r?(k([e],[r],n,t),r):r}function k(e,t,i,s){const n=j(i,!0),o=j(s,!0),a=P(i,v),l=P(s,v);if(a&&(0,r.pC)(n)&&(0,r.pC)(o))for(let r=0;r<e.length;r++){const i=t[r];if(!i)continue;const{x:s}=e[r],{x:h}=i;h>=o[1]-l&&Math.abs(s-n[0])<a?i.x-=o[1]-o[0]:h<=o[0]+l&&Math.abs(s-n[1])<a&&(i.x+=o[1]-o[0])}}function V(e){const{inSR:t,outSR:i,datumTransformation:s,preferPE:n}=e;if(t.equals(i)){const{points:t}=D(e,null);return t}if(t.isWebMercator&&i.isWGS84||t.isWGS84&&i.isWebMercator)return E(e);if(f(t,i,s)&&n){if(t.isGeographic)return I(e);const i=G(t);if((0,r.pC)(i))return I(e)}return T(e)}function T(e){const{points:t}=D(e,null),{inSR:i,outSR:s,datumTransformation:n}=e,r=t.map((e=>new c.Z(e[0],e[1],i))),o=(0,l.iV)(r,s,n);return n&&k(r,o,i,s),o.map((e=>e?[e.x,e.y]:[NaN,NaN]))}function I(e){const{inSR:t,outSR:i,datumTransformation:s}=e,n=G(t),{points:o,mask:l}=D(e,n);if(!t.isGeographic){const e=t.wkid?a.e.coordsys(t.wkid):a.e.fromString(t.isGeographic?a.f.PE_TYPE_GEOGCS:a.f.PE_TYPE_PROJCS,t.wkt);a.g.projToGeog(e,o.length,o)}if((0,r.pC)(s)&&s.steps.length){let e;const t=179.9955;if(i.isGeographic&&(e=o.map((([e])=>e>t?1:e<-t?-1:0))),s.steps.forEach((e=>{const t=e.wkid?a.e.geogtran(e.wkid):a.e.fromString(a.f.PE_TYPE_GEOGTRAN,e.wkt);a.h.geogToGeog(t,o.length,o,null,e.isInverse?a.f.PE_TRANSFORM_2_TO_1:a.f.PE_TRANSFORM_1_TO_2)})),e)for(let i=0;i<o.length;i++){const s=e[i],n=o[i][0],r=n>t?1:n<-t?-1:0;s&&r&&s!==r&&(o[i][0]=s>0?n+360:n-360)}}if(!i.isGeographic){const e=G(i,!0),t=(0,r.pC)(e)&&e.isEnvelope?[e.bbox[1],e.bbox[3]]:[-90,90];A(o,t);const s=i.wkid?a.e.coordsys(i.wkid):a.e.fromString(i.isGeographic?a.f.PE_TYPE_GEOGCS:a.f.PE_TYPE_PROJCS,i.wkt);a.g.geogToProj(s,o.length,o)}let h=o;if(l&&o.length!==l.length){h=[];for(let e=0,t=0;e<l.length;e++)l[e]?h.push(o[t++]):h.push([NaN,NaN])}return h}function E(e){const{cols:t,rows:i,xres:s,yres:n,usePixelCenter:r,inSR:o,outSR:a}=e;let{xmin:h,ymax:u}=e;r&&(h+=s/2,u-=n/2);const p=[],d=[],f=Math.max(t,i);for(let g=0;g<f;g++){const e=h+s*Math.min(t,g),r=u-n*Math.min(i,g),f=(0,l.iV)(new c.Z({x:e,y:r,spatialReference:o}),a);g<=t&&p.push(f.x),g<=i&&d.push(f.y)}const m=[];for(let l=0;l<t;l++)for(let e=0;e<i;e++)m.push([p[l],d[e]]);return m}function G(e,t=!1){let i=e.wkid||e.wkt;if(!i||e.isGeographic)return null;if(i=String(i),w.has(i)){const e=w.get(i);return t?e?.gcs:e?.pcs}const s=e.wkid?a.e.coordsys(e.wkid):a.e.fromString(e.isGeographic?a.f.PE_TYPE_GEOGCS:a.f.PE_TYPE_PROJCS,e.wkt),n=N(s,P(e,1e-4)),r=N(s,0,!0);return w.set(i,{pcs:n,gcs:r}),t?r:n}function N(e,t=0,i=!1){const s=a.j.generate(e),n=i?e.horizonGcsGenerate():e.horizonPcsGenerate();if(!s||!n?.length)return null;let r=!1,o=n.find((e=>1===e.getInclusive()&&1===e.getKind()));if(!o){if(o=n.find((e=>1===e.getInclusive()&&0===e.getKind())),!o)return null;r=!0}const l=i?0:(2===s.getNorthPoleLocation()?1:0)|(2===s.getSouthPoleLocation()?2:0),h=s.isPannableRectangle(),c=o.getCoord();if(r)return{isEnvelope:r,isPannable:h,vertices:c,coef:null,bbox:[c[0][0]-t,c[0][1]-t,c[1][0]+t,c[1][1]+t],poleLocation:l};let u=0;const p=[];let[d,f]=c[0],[m,g]=c[0];for(let a=0,y=c.length;a<y;a++){u++,u===y&&(u=0);const[e,t]=c[a],[i,s]=c[u];if(s===t)p.push([e,i,t,s,2]);else{const n=(i-e)/(s-t||1e-4),r=e-n*t;t<s?p.push([n,r,t,s,0]):p.push([n,r,s,t,1])}d=d<e?d:e,f=f<t?f:t,m=m>e?m:e,g=g>t?g:t}return{isEnvelope:!1,isPannable:h,vertices:c,coef:p,bbox:[d,f,m,g],poleLocation:l}}function D(e,t){const i=[],{cols:s,rows:n,xres:o,yres:a,usePixelCenter:l}=e;let{xmin:h,ymax:c}=e;if(l&&(h+=o/2,c-=a/2),(0,r.Wi)(t)){for(let e=0;e<s;e++)for(let t=0;t<n;t++)i.push([h+o*e,c-a*t]);return{points:i}}const u=new Uint8Array(s*n);if(t.isEnvelope){const{bbox:[e,r,l,p]}=t;for(let d=0,f=0;d<s;d++){const s=h+o*d,m=t.isPannable||s>=e&&s<=l;for(let e=0;e<n;e++,f++){const t=c-a*e;m&&t>=r&&t<=p&&(i.push([s,t]),u[f]=1)}}return{points:i,mask:u}}const p=t.coef,d=[];for(let r=0;r<n;r++){const e=c-a*r,t=[],i=[];for(let n=0;n<p.length;n++){const[s,r,o,a,l]=p[n];if(e===o&&o===a)t.push(s),t.push(r),i.push(2),i.push(2);else if(e>=o&&e<=a){const n=s*e+r;t.push(n),i.push(l)}}let s=t;if(t.length>2){let e=2===i[0]?0:i[0],n=t[0];s=[];for(let r=1;r<i.length;r++)2===i[r]&&r!==i.length-1||(i[r]!==e&&(s.push(0===e?Math.min(n,t[r-1]):Math.max(n,t[r-1])),e=i[r],n=t[r]),r===i.length-1&&s.push(0===i[r]?Math.min(n,t[r]):Math.max(n,t[r])));s.sort(((e,t)=>e-t))}else t[0]>t[1]&&(s=[t[1],t[0]]);d.push(s)}for(let r=0,f=0;r<s;r++){const e=h+o*r;for(let t=0;t<n;t++,f++){const s=c-a*t,n=d[t];if(2===n.length)e>=n[0]&&e<=n[1]&&(i.push([e,s]),u[f]=1);else if(n.length>2){let t=!1;for(let i=0;i<n.length;i+=2)if(e>=n[i]&&e<=n[i+1]){t=!0;break}t&&(i.push([e,s]),u[f]=1)}}}return{points:i,mask:u}}function A(e,t){const[i,s]=t;for(let n=0;n<e.length;n++){const t=e[n][1];(t<i||t>s)&&(e[n]=[NaN,NaN])}}function B(e){const t=L(e[0].spatialReference);if(e.length<2||(0,r.Wi)(t))return e[0];let{xmin:i,xmax:s,ymin:n,ymax:o}=e[0];for(let r=1;r<e.length;r++){const i=e[r];s=i.xmax+t*r,n=Math.min(n,i.ymin),o=Math.max(o,i.ymax)}return new h.Z({xmin:i,xmax:s,ymin:n,ymax:o,spatialReference:e[0].spatialReference})}function Z(e,t,i=null,n=!0){const o=e.spatialReference;if(o.equals(t))return e;const a=U(e),c=L(o,!0),u=L(t);if(0===a||(0,r.Wi)(c)||(0,r.Wi)(u)){const a=q(e,t,i,n);if((0,r.Wi)(c)&&(0,r.pC)(u)&&Math.abs(a.width-u)<P(t)&&(0,l.kR)()){const i=G(o);if((0,r.pC)(i)&&i.poleLocation===s.None&&e.width<(i.bbox[2]-i.bbox[0])/2)return O(e,t)||a}return a}const p=e.clone().normalize();if(1===p.length&&e.xmax<c&&e.xmax-c/2>P(o)){const{xmin:t,xmax:i}=e;for(let s=0;s<=a;s++){const n=0===s?t:-c/2,r=s===a?i-c*s:c/2;p[s]=new h.Z({xmin:n,xmax:r,ymin:e.ymin,ymax:e.ymax,spatialReference:o})}}return B(p.map((e=>q(e,t,i,n))).filter(r.pC))}function O(e,t){const i=L(t);if((0,r.Wi)(i))return null;let{xmin:s,ymin:n,xmax:o,ymax:a}=e;const c=e.spatialReference,p=new u.Z({spatialReference:c,rings:[[[s,n],[o,n],[o,a],[s,a],[s,n]]]}),d=(0,l.iV)(p,t);if(2!==d.rings.length||!d.rings[0].length||!d.rings[1].length)return null;const{rings:f}=d,m=P(c),g=new h.Z({spatialReference:t});for(let r=0;r<2;r++){s=o=f[r][0][0],n=a=f[r][0][1];for(let e=0;e<f[r].length;e++)s=s>f[r][e][0]?f[r][e][0]:s,o=o<f[r][e][0]?f[r][e][0]:o,n=n>f[r][e][1]?f[r][e][1]:n,a=a<f[r][e][1]?f[r][e][1]:a;if(0===r)g.ymin=n,g.ymax=a,g.xmin=s,g.xmax=o;else if(g.ymin=Math.min(g.ymin,n),g.ymax=Math.max(g.ymax,a),Math.abs(o-i/2)<m)g.xmin=s,g.xmax=g.xmax+i;else{if(!(Math.abs(s+i/2)<m))return null;g.xmax=o+i}}return g}function q(e,t,i=null,s=!0,n=!0){const o=e.spatialReference;if(o.equals(t)||!t)return e;f(o,t,i);const a=(0,l.iV)(e,t,i);if(n&&t.isWebMercator&&a&&(a.ymax=Math.min(20037508.342787,a.ymax),a.ymin=Math.max(-20037508.342787,a.ymin),a.ymin>=a.ymax))return null;if(!s||!a)return a;const h=j(o,!0),u=j(t,!0);if((0,r.Wi)(h)||(0,r.Wi)(u))return a;const p=P(o,.001),d=P(o,v),m=P(t,.001);if(Math.abs(a.xmin-u[0])<m&&Math.abs(a.xmax-u[1])<m){const s=Math.abs(e.xmin-h[0]),n=Math.abs(h[1]-e.xmax);if(s<p&&n>d){a.xmin=u[0];const s=[];s.push(new c.Z(e.xmax,e.ymin,o)),s.push(new c.Z(e.xmax,(e.ymin+e.ymax)/2,o)),s.push(new c.Z(e.xmax,e.ymax,o));const n=s.map((e=>M(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmax=Math.max.apply(null,n)}if(n<p&&s>d){a.xmax=u[1];const s=[];s.push(new c.Z(e.xmin,e.ymin,o)),s.push(new c.Z(e.xmin,(e.ymin+e.ymax)/2,o)),s.push(new c.Z(e.xmin,e.ymax,o));const n=s.map((e=>M(e,t,i))).filter((e=>!isNaN(e?.x))).map((e=>e.x));a.xmin=Math.min.apply(null,n)}}else{const e=P(t,.001);Math.abs(a.xmin-u[0])<e&&(a.xmin=u[0]),Math.abs(a.xmax-u[1])<e&&(a.xmax=u[1])}return a}function L(e,t=!1){if(!e)return null;const i=t?20037508.342787:20037508.342788905;return e.isWebMercator?2*i:e.wkid&&e.isGeographic?360:2*g[e.wkid]||null}function j(e,t=!1){if(e.isGeographic)return[-180,180];const i=L(e,t);return(0,r.pC)(i)?[-i/2,i/2]:null}function W(e,t,i,s){let n=(e-t)/i;return n-Math.floor(n)!=0?n=Math.floor(n):s&&(n-=1),n}function U(e,t=!1){const i=L(e.spatialReference);if((0,r.Wi)(i))return 0;const s=t?0:-i/2,n=P(e.spatialReference),o=!t&&Math.abs(e.xmax-i/2)<n?i/2:e.xmax,a=!t&&Math.abs(e.xmin+i/2)<n?-i/2:e.xmin;return W(o,s,i,!0)-W(a,s,i,!1)}function F(e){const t=e.storageInfo.origin.x,i=L(e.spatialReference,!0);if((0,r.Wi)(i))return{originX:t,halfWorldWidth:null,pyramidsInfo:null};const s=i/2,{nativePixelSize:n,storageInfo:o,extent:a}=e,{maximumPyramidLevel:l,blockWidth:h,pyramidScalingFactor:c}=o;let u=n.x;const p=[],d=(0,r.pC)(e.transform)&&"gcs-shift"===e.transform.type,f=t+(d?0:s),m=d?i-t:s-t;for(let r=0;r<=l;r++){const e=(a.xmax-t)/u/h,i=e-Math.floor(e)==0?e:Math.ceil(e),s=m/u/h,n=s-Math.floor(s)==0?s:Math.ceil(s),r=Math.floor(f/u/h),o=Math.round(f/u)%h,l=(h-Math.round(m/u)%h)%h;p.push({resolutionX:u,blockWidth:h,datsetColumnCount:i,worldColumnCountFromOrigin:n,leftMargin:o,rightPadding:l,originColumnOffset:r}),u*=c}return{originX:t,halfWorldWidth:s,pyramidsInfo:p,hasGCSSShiftTransform:d}}function z(e){if(!e||e.isGeographic)return e;const t=String(e.wkid||e.wkt);let i;return b.has(t)?i=b.get(t):(i=(e.wkid?a.e.coordsys(e.wkid):a.e.fromString(a.f.PE_TYPE_PROJCS,e.wkt)).getGeogcs().getCode(),b.set(t,i)),new p.Z({wkid:i})}function Y(e){const t=e.isAdaptive&&null==e.spacing;let i=e.spacing||[y,y],s=H(e),n={cols:s.size[0]+1,rows:s.size[1]+1};const o=s.outofBoundPointCount>0&&s.outofBoundPointCount<s.offsets.length/2;let a=s.outofBoundPointCount===s.offsets.length/2||t&&o?[0,0]:m(s.offsets,n,i,_);const l=(a[0]+a[1])/2,h=e.projectedExtent.spatialReference,c=e.srcBufferExtent.spatialReference;if(t&&(o||l>_)&&(d(h,c,e.datumTransformation)&&(h.isGeographic||(0,r.pC)(G(h))),i=[x,x],s=H({...e,spacing:i}),n={cols:s.size[0]+1,rows:s.size[1]+1},a=m(s.offsets,n,i,_)),s.error=a,i[0]>1&&(s.coefficients=J(s.offsets,n,o)),e.includeGCSGrid&&!h.isGeographic&&!h.isWebMercator)if(c.isGeographic)s.gcsGrid={offsets:s.offsets,coefficients:s.coefficients,spacing:i};else{const t=G(h);if((0,r.pC)(t)&&!t.isEnvelope){const t=z(h),r=Z(e.projectedExtent,t),{offsets:a}=H({...e,srcBufferExtent:r,spacing:i}),l=J(a,n,o);s.gcsGrid={offsets:a,coefficients:l,spacing:i}}}return s}function H(e){const{projectedExtent:t,srcBufferExtent:i,pixelSize:s,datumTransformation:n,rasterTransform:o}=e,a=t.spatialReference,l=i.spatialReference,h=f(a,l),{xmin:u,ymin:p,xmax:d,ymax:m}=t,g=L(l),_=(0,r.pC)(g)&&(e.hasWrapAround||"gcs-shift"===o?.type),w=e.spacing||[y,y],b=w[0]*s.x,S=w[1]*s.y,R=1===w[0],C=Math.ceil((d-u)/b-.1/w[0])+(R?0:1),M=Math.ceil((m-p)/S-.1/w[1])+(R?0:1),k=V({cols:C,rows:M,xmin:u,ymax:m,xres:b,yres:S,inSR:a,outSR:l,datumTransformation:n,preferPE:w[0]<=x,usePixelCenter:R}),T=[];let I,E=0;const N=R?-1:NaN,{xmin:D,xmax:A,ymax:B,width:Z,height:O}=i,q=P(l,v),j=(0,r.pC)(g)&&D>0&&A>g/2;let W=!1;if(h){const e=G(a);W=(0,r.pC)(e)&&e.poleLocation>0}for(let r=0;r<C;r++){const e=[];for(let t=0;t<M;t++){let i=k[r*M+t];if(_&&i[0]>A&&i[0]>g/2-q?i[0]-=g:_&&0===r&&i[0]<0&&j&&!o&&(i[0]+=g),!i||isNaN(i[0])||isNaN(i[1]))T.push(N),T.push(N),e.push(null),E++;else{if(o){const e=o.inverseTransform(new c.Z({x:i[0],y:i[1],spatialReference:l}));i=[e.x,e.y]}e.push(i),r>0&&_&&I[t]&&i[0]<I[t][0]&&(i[0]+=g,W&&i[0]>A&&i[0]>g&&(i[0]-=g)),T.push((i[0]-D)/Z),T.push((B-i[1])/O)}}I=e}return{offsets:T,error:null,coefficients:null,outofBoundPointCount:E,spacing:w,size:R?[C,M]:[C-1,M-1]}}function J(e,t,i){const{cols:s,rows:n}=t,r=new Float32Array((s-1)*(n-1)*2*6),o=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),a=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<s-1;l++){for(let t=0;t<n-1;t++){let i=l*n*2+2*t;const h=e[i],c=e[i+1],u=e[i+2],p=e[i+3];i+=2*n;const d=e[i],f=e[i+1],m=e[i+2],g=e[i+3];let y=0,x=12*(t*(s-1)+l);for(let e=0;e<3;e++)r[x++]=o[y++]*h+o[y++]*u+o[y++]*m;y=0;for(let e=0;e<3;e++)r[x++]=o[y++]*c+o[y++]*p+o[y++]*g;y=0;for(let e=0;e<3;e++)r[x++]=a[y++]*h+a[y++]*d+a[y++]*m;y=0;for(let e=0;e<3;e++)r[x++]=a[y++]*c+a[y++]*f+a[y++]*g}if(i)for(let e=0;e<r.length;e++)isNaN(r[e])&&(r[e]=-1)}return r}function X(e){const t=e.clone().normalize();return 1===t.length?t[0]:B(t)}function $(e,t,i){const{storageInfo:s,pixelSize:n}=t;let a=0,l=!1;const{pyramidResolutions:h}=s;if((0,r.pC)(h)&&h.length){const s=(e.x+e.y)/2,r=h[h.length-1],u=(r.x+r.y)/2,p=(n.x+n.y)/2;if(s<=p)a=0;else if(s>=u)a=h.length,l=s/u>8;else{let e,t=p;for(let n=1;n<=h.length;n++){if(e=(h[n-1].x+h[n-1].y)/2,s<=e){s===e?a=n:"down"===i?(a=n-1,l=s/t>8):a="up"===i||s-t>e-s||s/t>2?n:n-1;break}t=e}}const d=0===a?n:h[a-1];return l&&Math.min(d.x,d.y)*(0,o.c9)(t.spatialReference)>19567&&(l=!1),{pyramidLevel:a,pyramidResolution:new c.Z({x:d.x,y:d.y,spatialReference:t.spatialReference}),excessiveReading:l}}const u=Math.log(e.x/n.x)/Math.LN2,p=Math.log(e.y/n.y)/Math.LN2,d=t.storageInfo.maximumPyramidLevel||0;a="down"===i?Math.floor(Math.min(u,p)):"up"===i?Math.ceil(Math.max(u,p)):Math.round((u+p)/2),a<0?a=0:a>d&&(l=a>d+3,a=d);const f=2**a;return{pyramidLevel:a,pyramidResolution:new c.Z({x:f*t.nativePixelSize.x,y:f*t.nativePixelSize.y,spatialReference:t.spatialReference}),excessiveReading:l}}function K(e,t,i=512,s=!0){const{extent:n,spatialReference:a,pixelSize:l}=e,h=C(new c.Z({x:l.x,y:l.y,spatialReference:a}),t,n);if(null==h)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const u=(h.x+h.y)/2,p=(0,o.c9)(t),d=u*p*96*39.37,f=t.isGeographic?256/i*295828763.7958547:256/i*591657527.591555;let m="vector-magdir"===e.dataType||"vector-uv"===e.dataType;const g=Z(n,t),y=Math.min(Math.ceil(Math.log(Math.min(e.width,e.height)/32)/Math.LN2),Math.ceil(Math.log(f/2/d)/Math.LN2));if(!m&&s&&(t.isGeographic||t.isWebMercator)&&(m=g.xmin*g.xmax<0,!m&&y<3)){const e=L(t);if((0,r.pC)(e)){const t=2**y*u*i,s=Math.ceil(e/t);m=1===s||2===s&&e/2-g.xmax<t}}let x,_=d;const w=1.001;if(m){_=f;const e=t.isGeographic?1341104507446289e-21:.29858214164761665,i=e*(96*p*39.37),s=t.isGeographic?4326:3857;x=C(new c.Z({x:e,y:e,spatialReference:{wkid:s}}),a,g),x.x*=_/i,x.y*=_/i}else{x={x:l.x,y:l.y};let e=0;for(;_<f*(w/2)&&e<y;)e++,_*=2,x.x*=2,x.y*=2;Math.max(_,f)/Math.min(_,f)<=w&&(_=f)}const b=[_],v=[{x:x.x,y:x.y}],S=70.5310735,R=Math.min(S,d)/w;for(;_>=R;)_/=2,x.x/=2,x.y/=2,b.push(_),v.push({x:x.x,y:x.y});return{projectedPixelSize:h,scales:b,srcResolutions:v,isCustomTilingScheme:!m}}},86602:function(e,t,i){i.d(t,{JZ:function(){return d},RL:function(){return f},eY:function(){return g}});var s=i(61681),n=i(78668),r=i(1662),o=i(19710),a=i(55542),l=i(51118),h=i(7349),c=i(36172),u=i(91907),p=i(43487);function d(e){return e&&"render"in e}function f(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}function m(e){return d(e)?e instanceof h.Z?(0,s.yw)(e.getRenderedRasterPixels(),(e=>e.renderedRasterPixels)):f(e):e}class g extends l.s{constructor(e=null,t){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._width=void 0,this.x=0,this.y=0,this.immutable=t.immutable??!1,this.requestRenderOnSourceChangedEnabled=t.requestRenderOnSourceChangedEnabled??!0,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){this._texture&&(this._texture.dispose(),this._texture=null),(0,s.pC)(this._uploadStatus)&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width),this.invalidateTexture())}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}async setSourceAsync(e,t){(0,s.pC)(this._uploadStatus)&&this._uploadStatus.controller.abort();const i=new AbortController,r=(0,n.hh)();return(0,n.$F)(t,(()=>i.abort())),(0,n.$F)(i,(e=>r.reject(e))),this._uploadStatus={controller:i,resolver:r},this.source=e,r.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}updateTransitionProperties(e,t){e>=64&&(this.fadeTransitionEnabled=!1,this.inFadeTransition=!1),super.updateTransitionProperties(e,t)}setTransform(e){const t=(0,r.g)(this.transforms.dvs),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),n=this.resolution/this.pixelRatio/e.resolution,o=n*this.width,l=n*this.height,h=Math.PI*this.rotation/180;(0,r.h)(t,t,(0,a.f)(i,s)),(0,r.h)(t,t,(0,a.f)(o/2,l/2)),(0,r.r)(t,t,-h),(0,r.h)(t,t,(0,a.f)(-o/2,-l/2)),(0,r.k)(t,t,(0,a.f)(o,l)),(0,r.m)(this.transforms.dvs,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,t){this._texture&&e.bindTexture(this._texture,t)}async updateTexture({context:e,painter:t}){if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(e)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const i=m(this.source);try{if((0,s.pC)(this._uploadStatus)){const{controller:e,resolver:s}=this._uploadStatus,n={signal:e.signal},{width:r,height:o}=this,a=this._texture,l=t.textureUploadManager;await l.enqueueTextureUpdate({data:i,texture:a,width:r,height:o},n),s.resolve(),this._uploadStatus=null}else this._texture.setData(i);this.ready()}catch(r){(0,n.H9)(r)}}onDetach(){this.destroy()}_createTransforms(){return{dvs:(0,o.c)()}}_createTexture(e){const t=this.immutable&&e.type===c.zO.WEBGL2;return new p.x(e,{target:u.No.TEXTURE_2D,pixelFormat:u.VI.RGBA,internalFormat:t?u.lP.RGBA8:u.VI.RGBA,dataType:u.Br.UNSIGNED_BYTE,wrapMode:u.e8.CLAMP_TO_EDGE,isImmutable:t,width:this._sourceWidth,height:this._sourceHeight})}}},12688:function(e,t,i){i.d(t,{c:function(){return o}});var s=i(16943),n=i(38716),r=i(2443);class o extends r.Z{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}prepareRenderPasses(e){const t=e.registerRenderPass({name:"bitmap",brushes:[s.U.bitmap],target:()=>this.children,drawPhase:n.jx.MAP});return[...super.prepareRenderPasses(e),t]}_manageFade(){this.children.reduce(((e,t)=>e+(t.inFadeTransition?1:0)),0)>=2?(this.children.forEach((e=>e.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((e=>e.blendFunction="standard")),this._hasCrossfade=!1)}}},7349:function(e,t,i){i.d(t,{Z:function(){return n}});var s=i(61681);class n{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return(0,s.pC)(this.pixelBlock)?this.pixelBlock.width:0}get height(){return(0,s.pC)(this.pixelBlock)?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if((0,s.Wi)(t))return;const i=this.filter({pixelBlock:t});if((0,s.Wi)(i.pixelBlock))return;const n=i.pixelBlock.getAsRGBA(),r=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);r.data.set(n),e.putImageData(r,0,0)}getRenderedRasterPixels(){const e=this.filter({pixelBlock:this.pixelBlock});return(0,s.Wi)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}},36007:function(e,t,i){i.r(t),i.d(t,{default:function(){return A}});var s=i(36663),n=i(88256),r=i(33511),o=i(61681),a=i(76868),l=i(3466),h=i(81977),c=(i(7753),i(7283),i(40266)),u=i(91772),p=i(4757),d=i(14685),f=i(91103),m=i(84238),g=i(94449),y=i(86602),x=i(12688),_=i(81885),w=i(68114),b=i(9332),v=i(26216),S=i(66341),R=i(70909),C=i(18486),P=i(86424),M=i(3316),k=i(91907),V=i(18567),T=i(10054),I=i(29754),E=i(43487);class G{constructor(e){if(e)this._ownsRctx=!1,this._rctx=e;else{if(G._instance)return G._instanceRefCount++,G._instance;G._instanceRefCount=1,G._instance=this,this._ownsRctx=!0;const e=document.createElement("canvas").getContext("webgl");e.getExtension("OES_texture_float"),this._rctx=new I.x(e,{})}const t={applyProjection:!0,bilinear:!1,bicubic:!1},i=(0,M.s)("raster/reproject","raster/reproject",new Map([["a_position",0]]),t);this._program=this._rctx.programCache.acquire(i.shaders.vertexShader,i.shaders.fragmentShader,i.attributes),this._rctx.useProgram(this._program),this._program.setUniform1f("u_opacity",1),this._program.setUniform1i("u_image",0),this._program.setUniform1i("u_flipY",0),this._program.setUniform1i("u_transformGrid",1),this._quad=new P.Z(this._rctx,[0,0,1,0,0,1,1,1])}reprojectTexture(e,t,i=!1){const s=(0,p.iV)(e.extent,t),n=new R.Z({x:(e.extent.xmax-e.extent.xmin)/e.texture.descriptor.width,y:(e.extent.ymax-e.extent.ymin)/e.texture.descriptor.height,spatialReference:e.extent.spatialReference}),{x:r,y:o}=(0,C.VO)(n,t,e.extent);let a=(r+o)/2;const l=Math.round((s.xmax-s.xmin)/a),h=Math.round((s.ymax-s.ymin)/a);a=(s.width/l+s.height/h)/2;const c=new R.Z({x:a,y:a,spatialReference:s.spatialReference}),u=(0,C.Qp)({projectedExtent:s,srcBufferExtent:e.extent,pixelSize:c,hasWrapAround:!0,spacing:[16,16]}),d=(0,T.Br)(this._rctx,u),f=new E.x(this._rctx,{width:l,height:h,pixelFormat:k.VI.RGBA,dataType:k.Br.UNSIGNED_BYTE,wrapMode:k.e8.CLAMP_TO_EDGE,samplingMode:k.cw.LINEAR,hasMipmap:!1}),m=new V.X(this._rctx,{colorTarget:k.Lm.TEXTURE,depthStencilTarget:k.OU.NONE,width:l,height:h},f);if(this._rctx.bindFramebuffer(m),this._rctx.setViewport(0,0,l,h),this._rctx.useProgram(this._program),this._rctx.bindTexture(e.texture,0),this._rctx.bindTexture(d,1),this._quad.bind(),this._program.setUniform2f("u_srcImageSize",e.texture.descriptor.width,e.texture.descriptor.height),this._program.setUniform2fv("u_transformSpacing",u.spacing),this._program.setUniform2fv("u_transformGridSize",u.size),this._program.setUniform2f("u_targetImageSize",l,h),this._quad.draw(),this._quad.unbind(),this._rctx.useProgram(null),this._rctx.bindFramebuffer(null),d.dispose(),i){const e=new ImageData(m.descriptor.width,m.descriptor.height);return m.readPixels(0,0,m.descriptor.width,m.descriptor.height,k.VI.RGBA,k.Br.UNSIGNED_BYTE,e.data),m.detachColorTexture(k.VY.COLOR_ATTACHMENT0),m.dispose(),{texture:f,extent:s,imageData:e}}return m.detachColorTexture(k.VY.COLOR_ATTACHMENT0),m.dispose(),{texture:f,extent:s}}reprojectBitmapData(e,t){const i=(0,y.JZ)(e.bitmapData)?(0,y.RL)(e.bitmapData):e.bitmapData,s=new E.x(this._rctx,{width:e.bitmapData.width,height:e.bitmapData.height,pixelFormat:k.VI.RGBA,dataType:k.Br.UNSIGNED_BYTE,wrapMode:k.e8.CLAMP_TO_EDGE,samplingMode:k.cw.LINEAR,hasMipmap:!1},i),n=this.reprojectTexture({texture:s,extent:e.extent},t,!0);n.texture.dispose();const r=document.createElement("canvas");return r.width=n.imageData.width,r.height=n.imageData.height,r.getContext("2d").putImageData(n.imageData,0,0),{bitmapData:r,extent:n.extent}}async loadAndReprojectBitmapData(e,t,i){const s=(await(0,S["default"])(e,{responseType:"image"})).data,n=document.createElement("canvas");n.width=s.width,n.height=s.height;const r=n.getContext("2d");r.drawImage(s,0,0);const o=r.getImageData(0,0,n.width,n.height);if(t.spatialReference.equals(i))return{bitmapData:o,extent:t};const a=this.reprojectBitmapData({bitmapData:o,extent:t},i);return{bitmapData:a.bitmapData,extent:a.extent}}destroy(){this._ownsRctx?(G._instanceRefCount--,0===G._instanceRefCount&&(this._quad.dispose(),this._program.dispose(),this._rctx.dispose(),G._instance=null)):(this._quad.dispose(),this._program.dispose())}}G._instanceRefCount=0;class N{constructor(){this.allSublayers=new Map,this.allPoints=[],this.allPolylines=[],this.allPolygons=[],this.allMapImages=[]}}let D=class extends((0,_.y)(v.Z)){constructor(){super(...arguments),this._bitmapIndex=new Map,this._mapImageContainer=new x.c,this._kmlVisualData=new N,this.allVisiblePoints=new g.J,this.allVisiblePolylines=new g.J,this.allVisiblePolygons=new g.J,this.allVisibleMapImages=new r.Z}async hitTest(e,t){const i=this.layer;return[this._pointsView?.hitTest(e),this._polylinesView?.hitTest(e),this._polygonsView?.hitTest(e)].flat().filter(Boolean).map((t=>(t.layer=i,t.sourceLayer=i,{type:"graphic",graphic:t,layer:i,mapPoint:e})))}update(e){this._polygonsView&&this._polygonsView.processUpdate(e),this._polylinesView&&this._polylinesView.processUpdate(e),this._pointsView&&this._pointsView.processUpdate(e)}attach(){this._fetchController=new AbortController,this.container.addChild(this._mapImageContainer),this._polygonsView=new b.Z({view:this.view,graphics:this.allVisiblePolygons,requestUpdateCallback:()=>this.requestUpdate(),container:new w.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polygonsView.container),this._polylinesView=new b.Z({view:this.view,graphics:this.allVisiblePolylines,requestUpdateCallback:()=>this.requestUpdate(),container:new w.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._polylinesView.container),this._pointsView=new b.Z({view:this.view,graphics:this.allVisiblePoints,requestUpdateCallback:()=>this.requestUpdate(),container:new w.Z(this.view.featuresTilingScheme)}),this.container.addChild(this._pointsView.container),this.handles.add([this.allVisibleMapImages.on("change",(e=>{e.added.forEach((e=>this._addMapImage(e))),e.removed.forEach((e=>this._removeMapImage(e)))})),(0,a.YP)((()=>this.layer.visibleSublayers),(e=>{for(const[t,i]of this._kmlVisualData.allSublayers)i.visibility=0;for(const t of e){const e=this._kmlVisualData.allSublayers.get(t.id);e&&(e.visibility=1)}this._refreshCollections()}))]),this.updatingHandles.addPromise(this._fetchService(this._fetchController.signal)),this._imageReprojector=new G}detach(){this._fetchController.abort(),this._fetchController=null,this._mapImageContainer.removeAllChildren(),this.container.removeAllChildren(),this._bitmapIndex.clear(),this._polygonsView&&(this._polygonsView.destroy(),this._polygonsView=null),this._polylinesView&&(this._polylinesView.destroy(),this._polylinesView=null),this._pointsView&&(this._pointsView.destroy(),this._pointsView=null),this._imageReprojector&&(this._imageReprojector.destroy(),this._imageReprojector=null)}moveStart(){}viewChange(){this._polygonsView.viewChange(),this._polylinesView.viewChange(),this._pointsView.viewChange()}moveEnd(){}isUpdating(){return this._pointsView.updating||this._polygonsView.updating||this._polylinesView.updating}_addMapImage(e){(this.view.spatialReference.isWGS84||this.view.spatialReference.isWebMercator)&&this._imageReprojector.loadAndReprojectBitmapData(e.href,u.Z.fromJSON(e.extent),this.view.spatialReference).then((t=>{const i=new y.eY(t.bitmapData,{immutable:!1,requestRenderOnSourceChangedEnabled:!0});i.x=t.extent.xmin,i.y=t.extent.ymax,i.resolution=t.extent.width/t.bitmapData.width,i.rotation=e.rotation,this._mapImageContainer.addChild(i),this._bitmapIndex.set(e,i)}))}async _getViewDependentUrl(e,t){const{viewFormat:i,viewBoundScale:s,httpQuery:r}=e;if((0,o.pC)(i)){if((0,o.Wi)(t))throw new Error("Loading this network link requires a view state.");let a;if(await(0,p.zD)(),(0,o.pC)(s)&&1!==s){const e=new u.Z(t.extent);e.expand(s),a=e}else a=t.extent;a=(0,p.iV)(a,d.Z.WGS84);const h=(0,p.iV)(a,d.Z.WebMercator),c=a.xmin,f=a.xmax,g=a.ymin,y=a.ymax,x=t.size[0]*t.pixelRatio,_=t.size[1]*t.pixelRatio,w=Math.max(h.width,h.height),b={"[bboxWest]":c.toString(),"[bboxEast]":f.toString(),"[bboxSouth]":g.toString(),"[bboxNorth]":y.toString(),"[lookatLon]":a.center.x.toString(),"[lookatLat]":a.center.y.toString(),"[lookatRange]":w.toString(),"[lookatTilt]":"0","[lookatHeading]":t.rotation.toString(),"[lookatTerrainLon]":a.center.x.toString(),"[lookatTerrainLat]":a.center.y.toString(),"[lookatTerrainAlt]":"0","[cameraLon]":a.center.x.toString(),"[cameraLat]":a.center.y.toString(),"[cameraAlt]":w.toString(),"[horizFov]":"60","[vertFov]":"60","[horizPixels]":x.toString(),"[vertPixels]":_.toString(),"[terrainEnabled]":"0","[clientVersion]":n.i8,"[kmlVersion]":"2.2","[clientName]":"ArcGIS API for JavaScript","[language]":"en-US"},v=e=>{for(const t in e)for(const i in b)e[t]=e[t].replace(i,b[i])},S=(0,l.u0)(i);v(S);let R={};(0,o.pC)(r)&&(R=(0,l.u0)(r),v(R));const C=(0,m.en)(e.href);return C.query={...C.query,...S,...R},`${C.path}?${(0,l.B7)(S)}`}return e.href}async _fetchService(e){const t=new N;await this._loadVisualData(this.layer.url,t,e),this._kmlVisualData=t,this._refreshCollections()}_refreshCollections(){this.allVisiblePoints.removeAll(),this.allVisiblePolylines.removeAll(),this.allVisiblePolygons.removeAll(),this.allVisibleMapImages.removeAll(),this.allVisiblePoints.addMany(this._kmlVisualData.allPoints.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolylines.addMany(this._kmlVisualData.allPolylines.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisiblePolygons.addMany(this._kmlVisualData.allPolygons.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e))),this.allVisibleMapImages.addMany(this._kmlVisualData.allMapImages.filter((e=>this._isSublayerVisible(e.sublayerId))).map((({item:e})=>e)))}_isSublayerVisible(e){const t=this._kmlVisualData.allSublayers.get(e);return!!t.visibility&&(-1===t.parentFolderId||this._isSublayerVisible(t.parentFolderId))}_loadVisualData(e,t,i){return this._fetchParsedKML(e,i).then((async e=>{for(const s of e.sublayers){t.allSublayers.set(s.id,s);const e=s.points?await(0,f.Yu)(s.points):[],n=s.polylines?await(0,f.Yu)(s.polylines):[],r=s.polygons?await(0,f.Yu)(s.polygons):[],o=s.mapImages||[];if(t.allPoints.push(...e.map((e=>({item:e,sublayerId:s.id})))),t.allPolylines.push(...n.map((e=>({item:e,sublayerId:s.id})))),t.allPolygons.push(...r.map((e=>({item:e,sublayerId:s.id})))),t.allMapImages.push(...o.map((e=>({item:e,sublayerId:s.id})))),s.networkLink){const e=await this._getViewDependentUrl(s.networkLink,this.view.state);await this._loadVisualData(e,t,i)}}}))}_fetchParsedKML(e,t){return(0,f.CS)(e,this.layer.spatialReference,this.layer.refreshInterval,t).then((e=>(0,f.Cw)(e.data)))}_removeMapImage(e){const t=this._bitmapIndex.get(e);t&&(this._mapImageContainer.removeChild(t),this._bitmapIndex.delete(e))}};(0,s._)([(0,h.Cb)()],D.prototype,"_pointsView",void 0),(0,s._)([(0,h.Cb)()],D.prototype,"_polylinesView",void 0),(0,s._)([(0,h.Cb)()],D.prototype,"_polygonsView",void 0),(0,s._)([(0,h.Cb)()],D.prototype,"updating",void 0),D=(0,s._)([(0,c.j)("esri.views.2d.layers.KMLLayerView2D")],D);const A=D},81885:function(e,t,i){i.d(t,{y:function(){return k}});var s=i(36663),n=i(33511),r=i(58811),o=i(70375),a=i(76868),l=i(81977),h=(i(7753),i(7283),i(40266)),c=i(10530),u=i(72285);let p=class extends u.wq{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}};(0,s._)([(0,l.Cb)({readOnly:!0})],p.prototype,"version",null),p=(0,s._)([(0,h.j)("esri.views.layers.support.ClipArea")],p);const d=p;var f;let m=f=class extends d{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new f({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}};(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"left",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"right",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"top",void 0),(0,s._)([(0,l.Cb)({type:[Number,String],json:{write:!0}})],m.prototype,"bottom",void 0),m=f=(0,s._)([(0,h.j)("esri.views.layers.support.ClipRect")],m);const g=m;i(91957);var y,x=i(20031),_=i(53736),w=i(91772),b=i(89542);const v={base:x.Z,key:"type",typeMap:{extent:w.Z,polygon:b.Z}};let S=y=class extends d{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new y({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}};(0,s._)([(0,l.Cb)({types:v,json:{read:_.im,write:!0}})],S.prototype,"geometry",void 0),S=y=(0,s._)([(0,h.j)("esri.views.layers.support.Geometry")],S);const R=S;let C=class extends d{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}};(0,s._)([(0,l.Cb)({type:[[[Number]]],json:{write:!0}})],C.prototype,"path",void 0),C=(0,s._)([(0,h.j)("esri.views.layers.support.Path")],C);const P=C,M=n.Z.ofType({key:"type",base:null,typeMap:{rect:g,path:P,geometry:R}}),k=e=>{let t=class extends e{constructor(){super(...arguments),this.attached=!1,this.clips=new M,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this.visibleAtCurrentScale=!1}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new o.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.W),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.handles.add([(0,a.YP)((()=>this.suspended),(e=>{this.container&&(this.container.visible=!e),this.view&&!e&&this.updateRequested&&this.view.requestUpdate()}),a.tX),(0,a.YP)((()=>this.layer?.opacity??1),(e=>{this.container&&(this.container.opacity=e)}),a.tX),(0,a.YP)((()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal"),(e=>{this.container&&(this.container.blendMode=e)}),a.tX),(0,a.YP)((()=>this.layer&&"effect"in this.layer?this.layer.effect:null),(e=>{this.container&&(this.container.effect=e)}),a.tX),(0,a.on)((()=>this.clips),"change",(()=>{this.container&&(this.container.clips=this.clips)}),a.tX),(0,a.YP)((()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null})),(({scale:e})=>{const t=e&&this.isVisibleAtScale(e);t!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",t)}),a.tX)]),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then((e=>{e===this&&this.processAttach()}),(()=>{})):this.when().then((()=>{this.processAttach()}),(()=>{})))}destroy(){this.processDetach(),this.updateRequested=!1}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}isVisibleAtScale(e){const t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;const{minScale:i,maxScale:s}=t;return(0===i||e<=i)&&(0===s||e>=s)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){return!!this.spatialReferenceSupported&&!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported,i=this.visibleAtCurrentScale;return t&&(e.spatialReferenceNotSupported=t),i&&(e.outsideScaleRange=i),e}};return(0,s._)([(0,l.Cb)()],t.prototype,"attached",void 0),(0,s._)([(0,l.Cb)({type:M,set(e){const t=(0,r.Z)(e,this._get("clips"),M);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"container",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"moving",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"updateRequested",void 0),(0,s._)([(0,l.Cb)()],t.prototype,"updating",null),(0,s._)([(0,l.Cb)()],t.prototype,"view",void 0),(0,s._)([(0,l.Cb)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",void 0),t=(0,s._)([(0,h.j)("esri.views.2d.layers.LayerView2D")],t),t}},26216:function(e,t,i){i.d(t,{Z:function(){return f}});var s=i(36663),n=i(53404),r=i(31355),o=i(53280),a=i(86618),l=i(13802),h=i(61681),c=i(64189),u=i(81977),p=(i(7753),i(7283),i(40266));let d=class extends((0,o.p)((0,a.IG)((0,c.v)(r.Z.EventedMixin(n.Z))))){constructor(e){super(e),this.layer=null,this.parent=null}initialize(){this.when().catch((e=>{if("layerview:create-error"!==e.name){const t=this.layer&&this.layer.id||"no id",i=this.layer&&this.layer.title||"no title";l.Z.getLogger(this.declaredClass).error("#resolve()",`Failed to resolve layer view (layer title: '${i}', id: '${t}')`,e)}}))}get fullOpacity(){return(0,h.Pt)(this.get("layer.opacity"),1)*(0,h.Pt)(this.get("parent.fullOpacity"),1)}get suspended(){return!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){return!this.suspended&&!0===this.layer?.legendEnabled}get updating(){return!(!this.updatingHandles?.updating&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get visible(){return!0===this.layer?.visible}set visible(e){this._overrideIfSome("visible",e)}canResume(){return this.visible&&this.layer?.loaded&&!this.parent?.suspended&&this.view?.ready||!1}getSuspendInfo(){const e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{},t=this;return t.view&&t.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}isUpdating(){return!1}};(0,s._)([(0,u.Cb)()],d.prototype,"fullOpacity",null),(0,s._)([(0,u.Cb)()],d.prototype,"layer",void 0),(0,s._)([(0,u.Cb)()],d.prototype,"parent",void 0),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"suspended",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"suspendInfo",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"legendEnabled",null),(0,s._)([(0,u.Cb)({type:Boolean,readOnly:!0})],d.prototype,"updating",null),(0,s._)([(0,u.Cb)({readOnly:!0})],d.prototype,"updatingProgress",null),(0,s._)([(0,u.Cb)()],d.prototype,"visible",null),(0,s._)([(0,u.Cb)()],d.prototype,"view",void 0),d=(0,s._)([(0,p.j)("esri.views.layers.LayerView")],d);const f=d}}]);
//# sourceMappingURL=6007.187e3137.js.map